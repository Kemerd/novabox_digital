import{r as h,j as ye,a as Nn,p as kn,b as zr,i as zn,f as Bn,c as pt,d as Hn,V as jn,e as Zn,h as Gn,k as Wn,m as Yn,l as Xn}from"./main-CJN4baV7.js";import{e as Sr,u as Vn,a as $n,c as Kn,b as qn,i as Qn,E as Jn,B as ea,d as ta,T as ra,M as er,I as na,S as wt,D as aa,v as on,V as re,f as Br,Q as Tt,O as Kt,P as ur,g as dt,h as ht,j as Be,R as ia,k as oa,l as sn,H as Oe,F as Ve,m as mt,L as We,n as Ot,o as sa,p as Ct,U as la,q as ca,r as Ee,s as it,t as ln,w as ua,x as dr,C as qe,y as cn,z as Ir,W as yt,A as Qt,G as da,J as ha,K as br,N as vt,X as fa,Y as pa,Z as ma,_ as va,$ as ga,a0 as _r,a1 as qt,a2 as wa,a3 as ya,a4 as Hr,a5 as Ea,a6 as ba,a7 as Jt,a8 as _a,a9 as Ma,aa as xa,ab as Sa,ac as Ia,ad as jr,ae as Ra,af as Ft,ag as Zr,ah as Ta,ai as Ca,aj as Aa}from"./ThreeScene-D8k44bnv.js";function je(){return je=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var t in a)({}).hasOwnProperty.call(a,t)&&(n[t]=a[t])}return n},je.apply(null,arguments)}function Gr(n,e){let a;return(...t)=>{window.clearTimeout(a),a=window.setTimeout(()=>n(...t),e)}}function Oa({debounce:n,scroll:e,polyfill:a,offsetSize:t}={debounce:0,scroll:!1,offsetSize:!1}){const o=a||(typeof window>"u"?class{}:window.ResizeObserver);if(!o)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[l,f]=h.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),c=h.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:l,orientationHandler:null}),p=n?typeof n=="number"?n:n.scroll:null,u=n?typeof n=="number"?n:n.resize:null,M=h.useRef(!1);h.useEffect(()=>(M.current=!0,()=>void(M.current=!1)));const[x,y,L]=h.useMemo(()=>{const S=()=>{if(!c.current.element)return;const{left:R,top:Z,width:H,height:_,bottom:v,right:U,x:E,y:I}=c.current.element.getBoundingClientRect(),P={left:R,top:Z,width:H,height:_,bottom:v,right:U,x:E,y:I};c.current.element instanceof HTMLElement&&t&&(P.height=c.current.element.offsetHeight,P.width=c.current.element.offsetWidth),Object.freeze(P),M.current&&!Ua(c.current.lastBounds,P)&&f(c.current.lastBounds=P)};return[S,u?Gr(S,u):S,p?Gr(S,p):S]},[f,t,p,u]);function T(){c.current.scrollContainers&&(c.current.scrollContainers.forEach(S=>S.removeEventListener("scroll",L,!0)),c.current.scrollContainers=null),c.current.resizeObserver&&(c.current.resizeObserver.disconnect(),c.current.resizeObserver=null),c.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",c.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",c.current.orientationHandler))}function b(){c.current.element&&(c.current.resizeObserver=new o(L),c.current.resizeObserver.observe(c.current.element),e&&c.current.scrollContainers&&c.current.scrollContainers.forEach(S=>S.addEventListener("scroll",L,{capture:!0,passive:!0})),c.current.orientationHandler=()=>{L()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",c.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",c.current.orientationHandler))}const O=S=>{!S||S===c.current.element||(T(),c.current.element=S,c.current.scrollContainers=un(S),b())};return Fa(L,!!e),Pa(y),h.useEffect(()=>{T(),b()},[e,L,y]),h.useEffect(()=>T,[]),[O,l,x]}function Pa(n){h.useEffect(()=>{const e=n;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[n])}function Fa(n,e){h.useEffect(()=>{if(e){const a=n;return window.addEventListener("scroll",a,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",a,!0)}},[n,e])}function un(n){const e=[];if(!n||n===document.body)return e;const{overflow:a,overflowX:t,overflowY:o}=window.getComputedStyle(n);return[a,t,o].some(l=>l==="auto"||l==="scroll")&&e.push(n),[...e,...un(n.parentElement)]}const Da=["x","y","top","bottom","left","right","width","height"],Ua=(n,e)=>Da.every(a=>n[a]===e[a]);var La=Object.defineProperty,Na=Object.defineProperties,ka=Object.getOwnPropertyDescriptors,Wr=Object.getOwnPropertySymbols,za=Object.prototype.hasOwnProperty,Ba=Object.prototype.propertyIsEnumerable,Yr=(n,e,a)=>e in n?La(n,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[e]=a,Xr=(n,e)=>{for(var a in e||(e={}))za.call(e,a)&&Yr(n,a,e[a]);if(Wr)for(var a of Wr(e))Ba.call(e,a)&&Yr(n,a,e[a]);return n},Ha=(n,e)=>Na(n,ka(e)),Vr,$r;typeof window<"u"&&((Vr=window.document)!=null&&Vr.createElement||(($r=window.navigator)==null?void 0:$r.product)==="ReactNative")?h.useLayoutEffect:h.useEffect;function dn(n,e,a){if(!n)return;if(a(n)===!0)return n;let t=n.child;for(;t;){const o=dn(t,e,a);if(o)return o;t=t.sibling}}function hn(n){try{return Object.defineProperties(n,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return n}}const Kr=console.error;console.error=function(){const n=[...arguments].join("");if(n!=null&&n.startsWith("Warning:")&&n.includes("useContext")){console.error=Kr;return}return Kr.apply(this,arguments)};const Rr=hn(h.createContext(null));class fn extends h.Component{render(){return h.createElement(Rr.Provider,{value:this._reactInternals},this.props.children)}}function ja(){const n=h.useContext(Rr);if(n===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=h.useId();return h.useMemo(()=>{for(const t of[n,n==null?void 0:n.alternate]){if(!t)continue;const o=dn(t,!1,l=>{let f=l.memoizedState;for(;f;){if(f.memoizedState===e)return!0;f=f.next}});if(o)return o}},[n,e])}function Za(){const n=ja(),[e]=h.useState(()=>new Map);e.clear();let a=n;for(;a;){if(a.type&&typeof a.type=="object"){const o=a.type._context===void 0&&a.type.Provider===a.type?a.type:a.type._context;o&&o!==Rr&&!e.has(o)&&e.set(o,h.useContext(hn(o)))}a=a.return}return e}function Ga(){const n=Za();return h.useMemo(()=>Array.from(n.keys()).reduce((e,a)=>t=>h.createElement(e,null,h.createElement(a.Provider,Ha(Xr({},t),{value:n.get(a)}))),e=>h.createElement(fn,Xr({},e))),[n])}const Wa=h.forwardRef(function({children:e,fallback:a,resize:t,style:o,gl:l,events:f=qn,eventSource:c,eventPrefix:p,shadows:u,linear:M,flat:x,legacy:y,orthographic:L,frameloop:T,dpr:b,performance:O,raycaster:S,camera:R,scene:Z,onPointerMissed:H,onCreated:_,...v},U){h.useMemo(()=>Sr(ra),[]);const E=Ga(),[I,P]=Oa({scroll:!0,debounce:{scroll:50,resize:0},...t}),V=h.useRef(null),q=h.useRef(null);h.useImperativeHandle(U,()=>V.current);const $=Vn(H),[j,ee]=h.useState(!1),[K,be]=h.useState(!1);if(j)throw j;if(K)throw K;const ve=h.useRef(null);$n(()=>{const J=V.current;P.width>0&&P.height>0&&J&&(ve.current||(ve.current=Kn(J)),ve.current.configure({gl:l,events:f,shadows:u,linear:M,flat:x,legacy:y,orthographic:L,frameloop:T,dpr:b,performance:O,raycaster:S,camera:R,scene:Z,size:P,onPointerMissed:(...de)=>$.current==null?void 0:$.current(...de),onCreated:de=>{de.events.connect==null||de.events.connect(c?Qn(c)?c.current:c:q.current),p&&de.setEvents({compute:(ie,le)=>{const Re=ie[p+"X"],Ye=ie[p+"Y"];le.pointer.set(Re/le.size.width*2-1,-(Ye/le.size.height)*2+1),le.raycaster.setFromCamera(le.pointer,le.camera)}}),_==null||_(de)}}),ve.current.render(ye.jsx(E,{children:ye.jsx(Jn,{set:be,children:ye.jsx(h.Suspense,{fallback:ye.jsx(ea,{set:ee}),children:e??null})})})))}),h.useEffect(()=>{const J=V.current;if(J)return()=>ta(J)},[]);const _e=c?"none":"auto";return ye.jsx("div",{ref:q,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:_e,...o},...v,children:ye.jsx("div",{ref:I,style:{width:"100%",height:"100%"},children:ye.jsx("canvas",{ref:V,style:{display:"block"},children:a})})})}),Ya=h.forwardRef(function(e,a){return ye.jsx(fn,{children:ye.jsx(Wa,{...e,ref:a})})});var Ue=Uint8Array,Qe=Uint16Array,Mr=Uint32Array,pn=new Ue([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),mn=new Ue([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Xa=new Ue([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),vn=function(n,e){for(var a=new Qe(31),t=0;t<31;++t)a[t]=e+=1<<n[t-1];for(var o=new Mr(a[30]),t=1;t<30;++t)for(var l=a[t];l<a[t+1];++l)o[l]=l-a[t]<<5|t;return[a,o]},gn=vn(pn,2),wn=gn[0],Va=gn[1];wn[28]=258,Va[258]=28;var $a=vn(mn,0),Ka=$a[0],xr=new Qe(32768);for(var me=0;me<32768;++me){var Ke=(me&43690)>>>1|(me&21845)<<1;Ke=(Ke&52428)>>>2|(Ke&13107)<<2,Ke=(Ke&61680)>>>4|(Ke&3855)<<4,xr[me]=((Ke&65280)>>>8|(Ke&255)<<8)>>>1}var At=function(n,e,a){for(var t=n.length,o=0,l=new Qe(e);o<t;++o)++l[n[o]-1];var f=new Qe(e);for(o=0;o<e;++o)f[o]=f[o-1]+l[o-1]<<1;var c;if(a){c=new Qe(1<<e);var p=15-e;for(o=0;o<t;++o)if(n[o])for(var u=o<<4|n[o],M=e-n[o],x=f[n[o]-1]++<<M,y=x|(1<<M)-1;x<=y;++x)c[xr[x]>>>p]=u}else for(c=new Qe(t),o=0;o<t;++o)n[o]&&(c[o]=xr[f[n[o]-1]++]>>>15-n[o]);return c},Dt=new Ue(288);for(var me=0;me<144;++me)Dt[me]=8;for(var me=144;me<256;++me)Dt[me]=9;for(var me=256;me<280;++me)Dt[me]=7;for(var me=280;me<288;++me)Dt[me]=8;var yn=new Ue(32);for(var me=0;me<32;++me)yn[me]=5;var qa=At(Dt,9,1),Qa=At(yn,5,1),hr=function(n){for(var e=n[0],a=1;a<n.length;++a)n[a]>e&&(e=n[a]);return e},He=function(n,e,a){var t=e/8|0;return(n[t]|n[t+1]<<8)>>(e&7)&a},fr=function(n,e){var a=e/8|0;return(n[a]|n[a+1]<<8|n[a+2]<<16)>>(e&7)},Ja=function(n){return(n/8|0)+(n&7&&1)},ei=function(n,e,a){(a==null||a>n.length)&&(a=n.length);var t=new(n instanceof Qe?Qe:n instanceof Mr?Mr:Ue)(a-e);return t.set(n.subarray(e,a)),t},ti=function(n,e,a){var t=n.length;if(!t||a&&!a.l&&t<5)return e||new Ue(0);var o=!e||a,l=!a||a.i;a||(a={}),e||(e=new Ue(t*3));var f=function(oe){var Le=e.length;if(oe>Le){var Ne=new Ue(Math.max(Le*2,oe));Ne.set(e),e=Ne}},c=a.f||0,p=a.p||0,u=a.b||0,M=a.l,x=a.d,y=a.m,L=a.n,T=t*8;do{if(!M){a.f=c=He(n,p,1);var b=He(n,p+1,3);if(p+=3,b)if(b==1)M=qa,x=Qa,y=9,L=5;else if(b==2){var Z=He(n,p,31)+257,H=He(n,p+10,15)+4,_=Z+He(n,p+5,31)+1;p+=14;for(var v=new Ue(_),U=new Ue(19),E=0;E<H;++E)U[Xa[E]]=He(n,p+E*3,7);p+=H*3;for(var I=hr(U),P=(1<<I)-1,V=At(U,I,1),E=0;E<_;){var q=V[He(n,p,P)];p+=q&15;var O=q>>>4;if(O<16)v[E++]=O;else{var $=0,j=0;for(O==16?(j=3+He(n,p,3),p+=2,$=v[E-1]):O==17?(j=3+He(n,p,7),p+=3):O==18&&(j=11+He(n,p,127),p+=7);j--;)v[E++]=$}}var ee=v.subarray(0,Z),K=v.subarray(Z);y=hr(ee),L=hr(K),M=At(ee,y,1),x=At(K,L,1)}else throw"invalid block type";else{var O=Ja(p)+4,S=n[O-4]|n[O-3]<<8,R=O+S;if(R>t){if(l)throw"unexpected EOF";break}o&&f(u+S),e.set(n.subarray(O,R),u),a.b=u+=S,a.p=p=R*8;continue}if(p>T){if(l)throw"unexpected EOF";break}}o&&f(u+131072);for(var be=(1<<y)-1,ve=(1<<L)-1,_e=p;;_e=p){var $=M[fr(n,p)&be],J=$>>>4;if(p+=$&15,p>T){if(l)throw"unexpected EOF";break}if(!$)throw"invalid length/literal";if(J<256)e[u++]=J;else if(J==256){_e=p,M=null;break}else{var de=J-254;if(J>264){var E=J-257,ie=pn[E];de=He(n,p,(1<<ie)-1)+wn[E],p+=ie}var le=x[fr(n,p)&ve],Re=le>>>4;if(!le)throw"invalid distance";p+=le&15;var K=Ka[Re];if(Re>3){var ie=mn[Re];K+=fr(n,p)&(1<<ie)-1,p+=ie}if(p>T){if(l)throw"unexpected EOF";break}o&&f(u+131072);for(var Ye=u+de;u<Ye;u+=4)e[u]=e[u-K],e[u+1]=e[u+1-K],e[u+2]=e[u+2-K],e[u+3]=e[u+3-K];u=Ye}}a.l=M,a.p=_e,a.b=u,M&&(c=1,a.m=y,a.d=x,a.n=L)}while(!c);return u==e.length?e:ei(e,0,u)},ri=new Ue(0),ni=function(n){if((n[0]&15)!=8||n[0]>>>4>7||(n[0]<<8|n[1])%31)throw"invalid zlib data";if(n[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function Yt(n,e){return ti((ni(n),n.subarray(2,-4)),e)}var ai=typeof TextDecoder<"u"&&new TextDecoder,ii=0;try{ai.decode(ri,{stream:!0}),ii=1}catch{}const oi=n=>n&&n.isCubeTexture;class si extends er{constructor(e,a){var t,o;const l=oi(e),c=((o=l?(t=e.image[0])==null?void 0:t.width:e.image.width)!=null?o:1024)/4,p=Math.floor(Math.log2(c)),u=Math.pow(2,p),M=3*Math.max(u,16*7),x=4*u,y=[l?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/M}`,`#define CUBEUV_TEXEL_HEIGHT ${1/x}`,`#define CUBEUV_MAX_MIP ${p}.0`],L=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,T=y.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${on>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,b={map:{value:e},height:{value:(a==null?void 0:a.height)||15},radius:{value:(a==null?void 0:a.radius)||100}},O=new na(1,16),S=new wt({uniforms:b,fragmentShader:T,vertexShader:L,side:aa});super(O,S)}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}}var li=Object.defineProperty,ci=(n,e,a)=>e in n?li(n,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[e]=a,ui=(n,e,a)=>(ci(n,e+"",a),a);class di{constructor(){ui(this,"_listeners")}addEventListener(e,a){this._listeners===void 0&&(this._listeners={});const t=this._listeners;t[e]===void 0&&(t[e]=[]),t[e].indexOf(a)===-1&&t[e].push(a)}hasEventListener(e,a){if(this._listeners===void 0)return!1;const t=this._listeners;return t[e]!==void 0&&t[e].indexOf(a)!==-1}removeEventListener(e,a){if(this._listeners===void 0)return;const o=this._listeners[e];if(o!==void 0){const l=o.indexOf(a);l!==-1&&o.splice(l,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const t=this._listeners[e.type];if(t!==void 0){e.target=this;const o=t.slice(0);for(let l=0,f=o.length;l<f;l++)o[l].call(this,e);e.target=null}}}var hi=Object.defineProperty,fi=(n,e,a)=>e in n?hi(n,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[e]=a,X=(n,e,a)=>(fi(n,typeof e!="symbol"?e+"":e,a),a);const Xt=new ia,qr=new oa,pi=Math.cos(70*(Math.PI/180)),Qr=(n,e)=>(n%e+e)%e;let mi=class extends di{constructor(e,a){super(),X(this,"object"),X(this,"domElement"),X(this,"enabled",!0),X(this,"target",new re),X(this,"minDistance",0),X(this,"maxDistance",1/0),X(this,"minZoom",0),X(this,"maxZoom",1/0),X(this,"minPolarAngle",0),X(this,"maxPolarAngle",Math.PI),X(this,"minAzimuthAngle",-1/0),X(this,"maxAzimuthAngle",1/0),X(this,"enableDamping",!1),X(this,"dampingFactor",.05),X(this,"enableZoom",!0),X(this,"zoomSpeed",1),X(this,"enableRotate",!0),X(this,"rotateSpeed",1),X(this,"enablePan",!0),X(this,"panSpeed",1),X(this,"screenSpacePanning",!0),X(this,"keyPanSpeed",7),X(this,"zoomToCursor",!1),X(this,"autoRotate",!1),X(this,"autoRotateSpeed",2),X(this,"reverseOrbit",!1),X(this,"reverseHorizontalOrbit",!1),X(this,"reverseVerticalOrbit",!1),X(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),X(this,"mouseButtons",{LEFT:dt.ROTATE,MIDDLE:dt.DOLLY,RIGHT:dt.PAN}),X(this,"touches",{ONE:ht.ROTATE,TWO:ht.DOLLY_PAN}),X(this,"target0"),X(this,"position0"),X(this,"zoom0"),X(this,"_domElementKeyEvents",null),X(this,"getPolarAngle"),X(this,"getAzimuthalAngle"),X(this,"setPolarAngle"),X(this,"setAzimuthalAngle"),X(this,"getDistance"),X(this,"getZoomScale"),X(this,"listenToKeyEvents"),X(this,"stopListenToKeyEvents"),X(this,"saveState"),X(this,"reset"),X(this,"update"),X(this,"connect"),X(this,"dispose"),X(this,"dollyIn"),X(this,"dollyOut"),X(this,"getScale"),X(this,"setScale"),this.object=e,this.domElement=a,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>M.phi,this.getAzimuthalAngle=()=>M.theta,this.setPolarAngle=d=>{let A=Qr(d,2*Math.PI),G=M.phi;G<0&&(G+=2*Math.PI),A<0&&(A+=2*Math.PI);let ae=Math.abs(A-G);2*Math.PI-ae<ae&&(A<G?A+=2*Math.PI:G+=2*Math.PI),x.phi=A-G,t.update()},this.setAzimuthalAngle=d=>{let A=Qr(d,2*Math.PI),G=M.theta;G<0&&(G+=2*Math.PI),A<0&&(A+=2*Math.PI);let ae=Math.abs(A-G);2*Math.PI-ae<ae&&(A<G?A+=2*Math.PI:G+=2*Math.PI),x.theta=A-G,t.update()},this.getDistance=()=>t.object.position.distanceTo(t.target),this.listenToKeyEvents=d=>{d.addEventListener("keydown",st),this._domElementKeyEvents=d},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",st),this._domElementKeyEvents=null},this.saveState=()=>{t.target0.copy(t.target),t.position0.copy(t.object.position),t.zoom0=t.object.zoom},this.reset=()=>{t.target.copy(t.target0),t.object.position.copy(t.position0),t.object.zoom=t.zoom0,t.object.updateProjectionMatrix(),t.dispatchEvent(o),t.update(),p=c.NONE},this.update=(()=>{const d=new re,A=new re(0,1,0),G=new Tt().setFromUnitVectors(e.up,A),ae=G.clone().invert(),D=new re,Te=new Tt,Ze=2*Math.PI;return function(){const Gt=t.object.position;G.setFromUnitVectors(e.up,A),ae.copy(G).invert(),d.copy(Gt).sub(t.target),d.applyQuaternion(G),M.setFromVector3(d),t.autoRotate&&p===c.NONE&&j(q()),t.enableDamping?(M.theta+=x.theta*t.dampingFactor,M.phi+=x.phi*t.dampingFactor):(M.theta+=x.theta,M.phi+=x.phi);let ke=t.minAzimuthAngle,ze=t.maxAzimuthAngle;isFinite(ke)&&isFinite(ze)&&(ke<-Math.PI?ke+=Ze:ke>Math.PI&&(ke-=Ze),ze<-Math.PI?ze+=Ze:ze>Math.PI&&(ze-=Ze),ke<=ze?M.theta=Math.max(ke,Math.min(ze,M.theta)):M.theta=M.theta>(ke+ze)/2?Math.max(ke,M.theta):Math.min(ze,M.theta)),M.phi=Math.max(t.minPolarAngle,Math.min(t.maxPolarAngle,M.phi)),M.makeSafe(),t.enableDamping===!0?t.target.addScaledVector(L,t.dampingFactor):t.target.add(L),t.zoomToCursor&&I||t.object.isOrthographicCamera?M.radius=le(M.radius):M.radius=le(M.radius*y),d.setFromSpherical(M),d.applyQuaternion(ae),Gt.copy(t.target).add(d),t.object.matrixAutoUpdate||t.object.updateMatrix(),t.object.lookAt(t.target),t.enableDamping===!0?(x.theta*=1-t.dampingFactor,x.phi*=1-t.dampingFactor,L.multiplyScalar(1-t.dampingFactor)):(x.set(0,0,0),L.set(0,0,0));let tt=!1;if(t.zoomToCursor&&I){let rt=null;if(t.object instanceof ur&&t.object.isPerspectiveCamera){const nt=d.length();rt=le(nt*y);const ut=nt-rt;t.object.position.addScaledVector(U,ut),t.object.updateMatrixWorld()}else if(t.object.isOrthographicCamera){const nt=new re(E.x,E.y,0);nt.unproject(t.object),t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom/y)),t.object.updateProjectionMatrix(),tt=!0;const ut=new re(E.x,E.y,0);ut.unproject(t.object),t.object.position.sub(ut).add(nt),t.object.updateMatrixWorld(),rt=d.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),t.zoomToCursor=!1;rt!==null&&(t.screenSpacePanning?t.target.set(0,0,-1).transformDirection(t.object.matrix).multiplyScalar(rt).add(t.object.position):(Xt.origin.copy(t.object.position),Xt.direction.set(0,0,-1).transformDirection(t.object.matrix),Math.abs(t.object.up.dot(Xt.direction))<pi?e.lookAt(t.target):(qr.setFromNormalAndCoplanarPoint(t.object.up,t.target),Xt.intersectPlane(qr,t.target))))}else t.object instanceof Kt&&t.object.isOrthographicCamera&&(tt=y!==1,tt&&(t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom/y)),t.object.updateProjectionMatrix()));return y=1,I=!1,tt||D.distanceToSquared(t.object.position)>u||8*(1-Te.dot(t.object.quaternion))>u?(t.dispatchEvent(o),D.copy(t.object.position),Te.copy(t.object.quaternion),tt=!1,!0):!1}})(),this.connect=d=>{t.domElement=d,t.domElement.style.touchAction="none",t.domElement.addEventListener("contextmenu",Zt),t.domElement.addEventListener("pointerdown",Ht),t.domElement.addEventListener("pointercancel",Je),t.domElement.addEventListener("wheel",jt)},this.dispose=()=>{var d,A,G,ae,D,Te;t.domElement&&(t.domElement.style.touchAction="auto"),(d=t.domElement)==null||d.removeEventListener("contextmenu",Zt),(A=t.domElement)==null||A.removeEventListener("pointerdown",Ht),(G=t.domElement)==null||G.removeEventListener("pointercancel",Je),(ae=t.domElement)==null||ae.removeEventListener("wheel",jt),(D=t.domElement)==null||D.ownerDocument.removeEventListener("pointermove",ot),(Te=t.domElement)==null||Te.ownerDocument.removeEventListener("pointerup",Je),t._domElementKeyEvents!==null&&t._domElementKeyEvents.removeEventListener("keydown",st)};const t=this,o={type:"change"},l={type:"start"},f={type:"end"},c={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let p=c.NONE;const u=1e-6,M=new Br,x=new Br;let y=1;const L=new re,T=new Be,b=new Be,O=new Be,S=new Be,R=new Be,Z=new Be,H=new Be,_=new Be,v=new Be,U=new re,E=new Be;let I=!1;const P=[],V={};function q(){return 2*Math.PI/60/60*t.autoRotateSpeed}function $(){return Math.pow(.95,t.zoomSpeed)}function j(d){t.reverseOrbit||t.reverseHorizontalOrbit?x.theta+=d:x.theta-=d}function ee(d){t.reverseOrbit||t.reverseVerticalOrbit?x.phi+=d:x.phi-=d}const K=(()=>{const d=new re;return function(G,ae){d.setFromMatrixColumn(ae,0),d.multiplyScalar(-G),L.add(d)}})(),be=(()=>{const d=new re;return function(G,ae){t.screenSpacePanning===!0?d.setFromMatrixColumn(ae,1):(d.setFromMatrixColumn(ae,0),d.crossVectors(t.object.up,d)),d.multiplyScalar(G),L.add(d)}})(),ve=(()=>{const d=new re;return function(G,ae){const D=t.domElement;if(D&&t.object instanceof ur&&t.object.isPerspectiveCamera){const Te=t.object.position;d.copy(Te).sub(t.target);let Ze=d.length();Ze*=Math.tan(t.object.fov/2*Math.PI/180),K(2*G*Ze/D.clientHeight,t.object.matrix),be(2*ae*Ze/D.clientHeight,t.object.matrix)}else D&&t.object instanceof Kt&&t.object.isOrthographicCamera?(K(G*(t.object.right-t.object.left)/t.object.zoom/D.clientWidth,t.object.matrix),be(ae*(t.object.top-t.object.bottom)/t.object.zoom/D.clientHeight,t.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),t.enablePan=!1)}})();function _e(d){t.object instanceof ur&&t.object.isPerspectiveCamera||t.object instanceof Kt&&t.object.isOrthographicCamera?y=d:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),t.enableZoom=!1)}function J(d){_e(y/d)}function de(d){_e(y*d)}function ie(d){if(!t.zoomToCursor||!t.domElement)return;I=!0;const A=t.domElement.getBoundingClientRect(),G=d.clientX-A.left,ae=d.clientY-A.top,D=A.width,Te=A.height;E.x=G/D*2-1,E.y=-(ae/Te)*2+1,U.set(E.x,E.y,1).unproject(t.object).sub(t.object.position).normalize()}function le(d){return Math.max(t.minDistance,Math.min(t.maxDistance,d))}function Re(d){T.set(d.clientX,d.clientY)}function Ye(d){ie(d),H.set(d.clientX,d.clientY)}function oe(d){S.set(d.clientX,d.clientY)}function Le(d){b.set(d.clientX,d.clientY),O.subVectors(b,T).multiplyScalar(t.rotateSpeed);const A=t.domElement;A&&(j(2*Math.PI*O.x/A.clientHeight),ee(2*Math.PI*O.y/A.clientHeight)),T.copy(b),t.update()}function Ne(d){_.set(d.clientX,d.clientY),v.subVectors(_,H),v.y>0?J($()):v.y<0&&de($()),H.copy(_),t.update()}function rr(d){R.set(d.clientX,d.clientY),Z.subVectors(R,S).multiplyScalar(t.panSpeed),ve(Z.x,Z.y),S.copy(R),t.update()}function nr(d){ie(d),d.deltaY<0?de($()):d.deltaY>0&&J($()),t.update()}function Ut(d){let A=!1;switch(d.code){case t.keys.UP:ve(0,t.keyPanSpeed),A=!0;break;case t.keys.BOTTOM:ve(0,-t.keyPanSpeed),A=!0;break;case t.keys.LEFT:ve(t.keyPanSpeed,0),A=!0;break;case t.keys.RIGHT:ve(-t.keyPanSpeed,0),A=!0;break}A&&(d.preventDefault(),t.update())}function Lt(){if(P.length==1)T.set(P[0].pageX,P[0].pageY);else{const d=.5*(P[0].pageX+P[1].pageX),A=.5*(P[0].pageY+P[1].pageY);T.set(d,A)}}function Et(){if(P.length==1)S.set(P[0].pageX,P[0].pageY);else{const d=.5*(P[0].pageX+P[1].pageX),A=.5*(P[0].pageY+P[1].pageY);S.set(d,A)}}function bt(){const d=P[0].pageX-P[1].pageX,A=P[0].pageY-P[1].pageY,G=Math.sqrt(d*d+A*A);H.set(0,G)}function Nt(){t.enableZoom&&bt(),t.enablePan&&Et()}function ar(){t.enableZoom&&bt(),t.enableRotate&&Lt()}function kt(d){if(P.length==1)b.set(d.pageX,d.pageY);else{const G=ct(d),ae=.5*(d.pageX+G.x),D=.5*(d.pageY+G.y);b.set(ae,D)}O.subVectors(b,T).multiplyScalar(t.rotateSpeed);const A=t.domElement;A&&(j(2*Math.PI*O.x/A.clientHeight),ee(2*Math.PI*O.y/A.clientHeight)),T.copy(b)}function zt(d){if(P.length==1)R.set(d.pageX,d.pageY);else{const A=ct(d),G=.5*(d.pageX+A.x),ae=.5*(d.pageY+A.y);R.set(G,ae)}Z.subVectors(R,S).multiplyScalar(t.panSpeed),ve(Z.x,Z.y),S.copy(R)}function Bt(d){const A=ct(d),G=d.pageX-A.x,ae=d.pageY-A.y,D=Math.sqrt(G*G+ae*ae);_.set(0,D),v.set(0,Math.pow(_.y/H.y,t.zoomSpeed)),J(v.y),H.copy(_)}function ir(d){t.enableZoom&&Bt(d),t.enablePan&&zt(d)}function or(d){t.enableZoom&&Bt(d),t.enableRotate&&kt(d)}function Ht(d){var A,G;t.enabled!==!1&&(P.length===0&&((A=t.domElement)==null||A.ownerDocument.addEventListener("pointermove",ot),(G=t.domElement)==null||G.ownerDocument.addEventListener("pointerup",Je)),cr(d),d.pointerType==="touch"?lt(d):_t(d))}function ot(d){t.enabled!==!1&&(d.pointerType==="touch"?lr(d):sr(d))}function Je(d){var A,G,ae;et(d),P.length===0&&((A=t.domElement)==null||A.releasePointerCapture(d.pointerId),(G=t.domElement)==null||G.ownerDocument.removeEventListener("pointermove",ot),(ae=t.domElement)==null||ae.ownerDocument.removeEventListener("pointerup",Je)),t.dispatchEvent(f),p=c.NONE}function _t(d){let A;switch(d.button){case 0:A=t.mouseButtons.LEFT;break;case 1:A=t.mouseButtons.MIDDLE;break;case 2:A=t.mouseButtons.RIGHT;break;default:A=-1}switch(A){case dt.DOLLY:if(t.enableZoom===!1)return;Ye(d),p=c.DOLLY;break;case dt.ROTATE:if(d.ctrlKey||d.metaKey||d.shiftKey){if(t.enablePan===!1)return;oe(d),p=c.PAN}else{if(t.enableRotate===!1)return;Re(d),p=c.ROTATE}break;case dt.PAN:if(d.ctrlKey||d.metaKey||d.shiftKey){if(t.enableRotate===!1)return;Re(d),p=c.ROTATE}else{if(t.enablePan===!1)return;oe(d),p=c.PAN}break;default:p=c.NONE}p!==c.NONE&&t.dispatchEvent(l)}function sr(d){if(t.enabled!==!1)switch(p){case c.ROTATE:if(t.enableRotate===!1)return;Le(d);break;case c.DOLLY:if(t.enableZoom===!1)return;Ne(d);break;case c.PAN:if(t.enablePan===!1)return;rr(d);break}}function jt(d){t.enabled===!1||t.enableZoom===!1||p!==c.NONE&&p!==c.ROTATE||(d.preventDefault(),t.dispatchEvent(l),nr(d),t.dispatchEvent(f))}function st(d){t.enabled===!1||t.enablePan===!1||Ut(d)}function lt(d){switch(Se(d),P.length){case 1:switch(t.touches.ONE){case ht.ROTATE:if(t.enableRotate===!1)return;Lt(),p=c.TOUCH_ROTATE;break;case ht.PAN:if(t.enablePan===!1)return;Et(),p=c.TOUCH_PAN;break;default:p=c.NONE}break;case 2:switch(t.touches.TWO){case ht.DOLLY_PAN:if(t.enableZoom===!1&&t.enablePan===!1)return;Nt(),p=c.TOUCH_DOLLY_PAN;break;case ht.DOLLY_ROTATE:if(t.enableZoom===!1&&t.enableRotate===!1)return;ar(),p=c.TOUCH_DOLLY_ROTATE;break;default:p=c.NONE}break;default:p=c.NONE}p!==c.NONE&&t.dispatchEvent(l)}function lr(d){switch(Se(d),p){case c.TOUCH_ROTATE:if(t.enableRotate===!1)return;kt(d),t.update();break;case c.TOUCH_PAN:if(t.enablePan===!1)return;zt(d),t.update();break;case c.TOUCH_DOLLY_PAN:if(t.enableZoom===!1&&t.enablePan===!1)return;ir(d),t.update();break;case c.TOUCH_DOLLY_ROTATE:if(t.enableZoom===!1&&t.enableRotate===!1)return;or(d),t.update();break;default:p=c.NONE}}function Zt(d){t.enabled!==!1&&d.preventDefault()}function cr(d){P.push(d)}function et(d){delete V[d.pointerId];for(let A=0;A<P.length;A++)if(P[A].pointerId==d.pointerId){P.splice(A,1);return}}function Se(d){let A=V[d.pointerId];A===void 0&&(A=new Be,V[d.pointerId]=A),A.set(d.pageX,d.pageY)}function ct(d){const A=d.pointerId===P[0].pointerId?P[1]:P[0];return V[A.pointerId]}this.dollyIn=(d=$())=>{de(d),t.update()},this.dollyOut=(d=$())=>{J(d),t.update()},this.getScale=()=>y,this.setScale=d=>{_e(d),t.update()},this.getZoomScale=()=>$(),a!==void 0&&this.connect(a),this.update()}};const vi={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`
      varying vec2 vUv;

      void main() {

        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

      }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform float h;

    varying vec2 vUv;

    void main() {

    	vec4 sum = vec4( 0.0 );

    	sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

    	gl_FragColor = sum;

    }
  `},gi={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`
    varying vec2 vUv;

    void main() {

      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`

  uniform sampler2D tDiffuse;
  uniform float v;

  varying vec2 vUv;

  void main() {

    vec4 sum = vec4( 0.0 );

    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

    gl_FragColor = sum;

  }
  `};class wi extends sn{constructor(e){super(e),this.type=Oe}parse(e){const f=function(E,I){switch(E){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(I||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(I||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(I||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(I||""))}},M=`
`,x=function(E,I,P){I=I||1024;let q=E.pos,$=-1,j=0,ee="",K=String.fromCharCode.apply(null,new Uint16Array(E.subarray(q,q+128)));for(;0>($=K.indexOf(M))&&j<I&&q<E.byteLength;)ee+=K,j+=K.length,q+=128,K+=String.fromCharCode.apply(null,new Uint16Array(E.subarray(q,q+128)));return-1<$?(E.pos+=j+$+1,ee+K.slice(0,$)):!1},y=function(E){const I=/^#\?(\S+)/,P=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,V=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,q=/^\s*FORMAT=(\S+)\s*$/,$=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,j={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let ee,K;for((E.pos>=E.byteLength||!(ee=x(E)))&&f(1,"no header found"),(K=ee.match(I))||f(3,"bad initial token"),j.valid|=1,j.programtype=K[1],j.string+=ee+`
`;ee=x(E),ee!==!1;){if(j.string+=ee+`
`,ee.charAt(0)==="#"){j.comments+=ee+`
`;continue}if((K=ee.match(P))&&(j.gamma=parseFloat(K[1])),(K=ee.match(V))&&(j.exposure=parseFloat(K[1])),(K=ee.match(q))&&(j.valid|=2,j.format=K[1]),(K=ee.match($))&&(j.valid|=4,j.height=parseInt(K[1],10),j.width=parseInt(K[2],10)),j.valid&2&&j.valid&4)break}return j.valid&2||f(3,"missing format specifier"),j.valid&4||f(3,"missing image size specifier"),j},L=function(E,I,P){const V=I;if(V<8||V>32767||E[0]!==2||E[1]!==2||E[2]&128)return new Uint8Array(E);V!==(E[2]<<8|E[3])&&f(3,"wrong scanline width");const q=new Uint8Array(4*I*P);q.length||f(4,"unable to allocate buffer space");let $=0,j=0;const ee=4*V,K=new Uint8Array(4),be=new Uint8Array(ee);let ve=P;for(;ve>0&&j<E.byteLength;){j+4>E.byteLength&&f(1),K[0]=E[j++],K[1]=E[j++],K[2]=E[j++],K[3]=E[j++],(K[0]!=2||K[1]!=2||(K[2]<<8|K[3])!=V)&&f(3,"bad rgbe scanline format");let _e=0,J;for(;_e<ee&&j<E.byteLength;){J=E[j++];const ie=J>128;if(ie&&(J-=128),(J===0||_e+J>ee)&&f(3,"bad scanline data"),ie){const le=E[j++];for(let Re=0;Re<J;Re++)be[_e++]=le}else be.set(E.subarray(j,j+J),_e),_e+=J,j+=J}const de=V;for(let ie=0;ie<de;ie++){let le=0;q[$]=be[ie+le],le+=V,q[$+1]=be[ie+le],le+=V,q[$+2]=be[ie+le],le+=V,q[$+3]=be[ie+le],$+=4}ve--}return q},T=function(E,I,P,V){const q=E[I+3],$=Math.pow(2,q-128)/255;P[V+0]=E[I+0]*$,P[V+1]=E[I+1]*$,P[V+2]=E[I+2]*$,P[V+3]=1},b=function(E,I,P,V){const q=E[I+3],$=Math.pow(2,q-128)/255;P[V+0]=mt.toHalfFloat(Math.min(E[I+0]*$,65504)),P[V+1]=mt.toHalfFloat(Math.min(E[I+1]*$,65504)),P[V+2]=mt.toHalfFloat(Math.min(E[I+2]*$,65504)),P[V+3]=mt.toHalfFloat(1)},O=new Uint8Array(e);O.pos=0;const S=y(O),R=S.width,Z=S.height,H=L(O.subarray(O.pos),R,Z);let _,v,U;switch(this.type){case Ve:U=H.length/4;const E=new Float32Array(U*4);for(let P=0;P<U;P++)T(H,P*4,E,P*4);_=E,v=Ve;break;case Oe:U=H.length/4;const I=new Uint16Array(U*4);for(let P=0;P<U;P++)b(H,P*4,I,P*4);_=I,v=Oe;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:R,height:Z,data:_,header:S.string,gamma:S.gamma,exposure:S.exposure,type:v}}setDataType(e){return this.type=e,this}load(e,a,t,o){function l(f,c){switch(f.type){case Ve:case Oe:"colorSpace"in f?f.colorSpace="srgb-linear":f.encoding=3e3,f.minFilter=We,f.magFilter=We,f.generateMipmaps=!1,f.flipY=!0;break}a&&a(f,c)}return super.load(e,l,t,o)}}const It=on>=152;class yi extends sn{constructor(e){super(e),this.type=Oe}parse(e){const I=Math.pow(2.7182818,2.2);function P(r,i){for(var s=0,m=0;m<65536;++m)(m==0||r[m>>3]&1<<(m&7))&&(i[s++]=m);for(var g=s-1;s<65536;)i[s++]=0;return g}function V(r){for(var i=0;i<16384;i++)r[i]={},r[i].len=0,r[i].lit=0,r[i].p=null}const q={l:0,c:0,lc:0};function $(r,i,s,m,g){for(;s<r;)i=i<<8|ct(m,g),s+=8;s-=r,q.l=i>>s&(1<<r)-1,q.c=i,q.lc=s}const j=new Array(59);function ee(r){for(var i=0;i<=58;++i)j[i]=0;for(var i=0;i<65537;++i)j[r[i]]+=1;for(var s=0,i=58;i>0;--i){var m=s+j[i]>>1;j[i]=s,s=m}for(var i=0;i<65537;++i){var g=r[i];g>0&&(r[i]=g|j[g]++<<6)}}function K(r,i,s,m,g,w,F){for(var C=s,z=0,k=0;g<=w;g++){if(C.value-s.value>m)return!1;$(6,z,k,r,C);var B=q.l;if(z=q.c,k=q.lc,F[g]=B,B==63){if(C.value-s.value>m)throw"Something wrong with hufUnpackEncTable";$(8,z,k,r,C);var N=q.l+6;if(z=q.c,k=q.lc,g+N>w+1)throw"Something wrong with hufUnpackEncTable";for(;N--;)F[g++]=0;g--}else if(B>=59){var N=B-59+2;if(g+N>w+1)throw"Something wrong with hufUnpackEncTable";for(;N--;)F[g++]=0;g--}}ee(F)}function be(r){return r&63}function ve(r){return r>>6}function _e(r,i,s,m){for(;i<=s;i++){var g=ve(r[i]),w=be(r[i]);if(g>>w)throw"Invalid table entry";if(w>14){var F=m[g>>w-14];if(F.len)throw"Invalid table entry";if(F.lit++,F.p){var C=F.p;F.p=new Array(F.lit);for(var z=0;z<F.lit-1;++z)F.p[z]=C[z]}else F.p=new Array(1);F.p[F.lit-1]=i}else if(w)for(var k=0,z=1<<14-w;z>0;z--){var F=m[(g<<14-w)+k];if(F.len||F.p)throw"Invalid table entry";F.len=w,F.lit=i,k++}}return!0}const J={c:0,lc:0};function de(r,i,s,m){r=r<<8|ct(s,m),i+=8,J.c=r,J.lc=i}const ie={c:0,lc:0};function le(r,i,s,m,g,w,F,C,z,k){if(r==i){m<8&&(de(s,m,g,F),s=J.c,m=J.lc),m-=8;var B=s>>m,B=new Uint8Array([B])[0];if(z.value+B>k)return!1;for(var N=C[z.value-1];B-- >0;)C[z.value++]=N}else if(z.value<k)C[z.value++]=r;else return!1;ie.c=s,ie.lc=m}function Re(r){return r&65535}function Ye(r){var i=Re(r);return i>32767?i-65536:i}const oe={a:0,b:0};function Le(r,i){var s=Ye(r),m=Ye(i),g=m,w=s+(g&1)+(g>>1),F=w,C=w-g;oe.a=F,oe.b=C}function Ne(r,i){var s=Re(r),m=Re(i),g=s-(m>>1)&65535,w=m+g-32768&65535;oe.a=w,oe.b=g}function rr(r,i,s,m,g,w,F){for(var C=F<16384,z=s>g?g:s,k=1,B;k<=z;)k<<=1;for(k>>=1,B=k,k>>=1;k>=1;){for(var N=0,we=N+w*(g-B),W=w*k,Y=w*B,Q=m*k,te=m*B,ce,he,Me,Ce;N<=we;N+=Y){for(var fe=N,Ge=N+m*(s-B);fe<=Ge;fe+=te){var pe=fe+Q,xe=fe+W,Xe=xe+Q;C?(Le(r[fe+i],r[xe+i]),ce=oe.a,Me=oe.b,Le(r[pe+i],r[Xe+i]),he=oe.a,Ce=oe.b,Le(ce,he),r[fe+i]=oe.a,r[pe+i]=oe.b,Le(Me,Ce),r[xe+i]=oe.a,r[Xe+i]=oe.b):(Ne(r[fe+i],r[xe+i]),ce=oe.a,Me=oe.b,Ne(r[pe+i],r[Xe+i]),he=oe.a,Ce=oe.b,Ne(ce,he),r[fe+i]=oe.a,r[pe+i]=oe.b,Ne(Me,Ce),r[xe+i]=oe.a,r[Xe+i]=oe.b)}if(s&k){var xe=fe+W;C?Le(r[fe+i],r[xe+i]):Ne(r[fe+i],r[xe+i]),ce=oe.a,r[xe+i]=oe.b,r[fe+i]=ce}}if(g&k)for(var fe=N,Ge=N+m*(s-B);fe<=Ge;fe+=te){var pe=fe+Q;C?Le(r[fe+i],r[pe+i]):Ne(r[fe+i],r[pe+i]),ce=oe.a,r[pe+i]=oe.b,r[fe+i]=ce}B=k,k>>=1}return N}function nr(r,i,s,m,g,w,F,C,z,k){for(var B=0,N=0,we=C,W=Math.trunc(g.value+(w+7)/8);g.value<W;)for(de(B,N,s,g),B=J.c,N=J.lc;N>=14;){var Y=B>>N-14&16383,Q=i[Y];if(Q.len)N-=Q.len,le(Q.lit,F,B,N,s,m,g,z,k,we),B=ie.c,N=ie.lc;else{if(!Q.p)throw"hufDecode issues";var te;for(te=0;te<Q.lit;te++){for(var ce=be(r[Q.p[te]]);N<ce&&g.value<W;)de(B,N,s,g),B=J.c,N=J.lc;if(N>=ce&&ve(r[Q.p[te]])==(B>>N-ce&(1<<ce)-1)){N-=ce,le(Q.p[te],F,B,N,s,m,g,z,k,we),B=ie.c,N=ie.lc;break}}if(te==Q.lit)throw"hufDecode issues"}}var he=8-w&7;for(B>>=he,N-=he;N>0;){var Q=i[B<<14-N&16383];if(Q.len)N-=Q.len,le(Q.lit,F,B,N,s,m,g,z,k,we),B=ie.c,N=ie.lc;else throw"hufDecode issues"}return!0}function Ut(r,i,s,m,g,w){var F={value:0},C=s.value,z=Se(i,s),k=Se(i,s);s.value+=4;var B=Se(i,s);if(s.value+=4,z<0||z>=65537||k<0||k>=65537)throw"Something wrong with HUF_ENCSIZE";var N=new Array(65537),we=new Array(16384);V(we);var W=m-(s.value-C);if(K(r,i,s,W,z,k,N),B>8*(m-(s.value-C)))throw"Something wrong with hufUncompress";_e(N,z,k,we),nr(N,we,r,i,s,B,k,w,g,F)}function Lt(r,i,s){for(var m=0;m<s;++m)i[m]=r[i[m]]}function Et(r){for(var i=1;i<r.length;i++){var s=r[i-1]+r[i]-128;r[i]=s}}function bt(r,i){for(var s=0,m=Math.floor((r.length+1)/2),g=0,w=r.length-1;!(g>w||(i[g++]=r[s++],g>w));)i[g++]=r[m++]}function Nt(r){for(var i=r.byteLength,s=new Array,m=0,g=new DataView(r);i>0;){var w=g.getInt8(m++);if(w<0){var F=-w;i-=F+1;for(var C=0;C<F;C++)s.push(g.getUint8(m++))}else{var F=w;i-=2;for(var z=g.getUint8(m++),C=0;C<F+1;C++)s.push(z)}}return s}function ar(r,i,s,m,g,w){var pe=new DataView(w.buffer),F=s[r.idx[0]].width,C=s[r.idx[0]].height,z=3,k=Math.floor(F/8),B=Math.ceil(F/8),N=Math.ceil(C/8),we=F-(B-1)*8,W=C-(N-1)*8,Y={value:0},Q=new Array(z),te=new Array(z),ce=new Array(z),he=new Array(z),Me=new Array(z);for(let ue=0;ue<z;++ue)Me[ue]=i[r.idx[ue]],Q[ue]=ue<1?0:Q[ue-1]+B*N,te[ue]=new Float32Array(64),ce[ue]=new Uint16Array(64),he[ue]=new Uint16Array(B*64);for(let ue=0;ue<N;++ue){var Ce=8;ue==N-1&&(Ce=W);var fe=8;for(let ge=0;ge<B;++ge){ge==B-1&&(fe=we);for(let se=0;se<z;++se)ce[se].fill(0),ce[se][0]=g[Q[se]++],kt(Y,m,ce[se]),zt(ce[se],te[se]),Bt(te[se]);ir(te);for(let se=0;se<z;++se)or(te[se],he[se],ge*64)}let Ie=0;for(let ge=0;ge<z;++ge){const se=s[r.idx[ge]].type;for(let Fe=8*ue;Fe<8*ue+Ce;++Fe){Ie=Me[ge][Fe];for(let at=0;at<k;++at){const Ae=at*64+(Fe&7)*8;pe.setUint16(Ie+0*2*se,he[ge][Ae+0],!0),pe.setUint16(Ie+1*2*se,he[ge][Ae+1],!0),pe.setUint16(Ie+2*2*se,he[ge][Ae+2],!0),pe.setUint16(Ie+3*2*se,he[ge][Ae+3],!0),pe.setUint16(Ie+4*2*se,he[ge][Ae+4],!0),pe.setUint16(Ie+5*2*se,he[ge][Ae+5],!0),pe.setUint16(Ie+6*2*se,he[ge][Ae+6],!0),pe.setUint16(Ie+7*2*se,he[ge][Ae+7],!0),Ie+=8*2*se}}if(k!=B)for(let Fe=8*ue;Fe<8*ue+Ce;++Fe){const at=Me[ge][Fe]+8*k*2*se,Ae=k*64+(Fe&7)*8;for(let $e=0;$e<fe;++$e)pe.setUint16(at+$e*2*se,he[ge][Ae+$e],!0)}}}for(var Ge=new Uint16Array(F),pe=new DataView(w.buffer),xe=0;xe<z;++xe){s[r.idx[xe]].decoded=!0;var Xe=s[r.idx[xe]].type;if(s[xe].type==2)for(var St=0;St<C;++St){const ue=Me[xe][St];for(var Pe=0;Pe<F;++Pe)Ge[Pe]=pe.getUint16(ue+Pe*2*Xe,!0);for(var Pe=0;Pe<F;++Pe)pe.setFloat32(ue+Pe*2*Xe,D(Ge[Pe]),!0)}}}function kt(r,i,s){for(var m,g=1;g<64;)m=i[r.value],m==65280?g=64:m>>8==255?g+=m&255:(s[g]=m,g++),r.value++}function zt(r,i){i[0]=D(r[0]),i[1]=D(r[1]),i[2]=D(r[5]),i[3]=D(r[6]),i[4]=D(r[14]),i[5]=D(r[15]),i[6]=D(r[27]),i[7]=D(r[28]),i[8]=D(r[2]),i[9]=D(r[4]),i[10]=D(r[7]),i[11]=D(r[13]),i[12]=D(r[16]),i[13]=D(r[26]),i[14]=D(r[29]),i[15]=D(r[42]),i[16]=D(r[3]),i[17]=D(r[8]),i[18]=D(r[12]),i[19]=D(r[17]),i[20]=D(r[25]),i[21]=D(r[30]),i[22]=D(r[41]),i[23]=D(r[43]),i[24]=D(r[9]),i[25]=D(r[11]),i[26]=D(r[18]),i[27]=D(r[24]),i[28]=D(r[31]),i[29]=D(r[40]),i[30]=D(r[44]),i[31]=D(r[53]),i[32]=D(r[10]),i[33]=D(r[19]),i[34]=D(r[23]),i[35]=D(r[32]),i[36]=D(r[39]),i[37]=D(r[45]),i[38]=D(r[52]),i[39]=D(r[54]),i[40]=D(r[20]),i[41]=D(r[22]),i[42]=D(r[33]),i[43]=D(r[38]),i[44]=D(r[46]),i[45]=D(r[51]),i[46]=D(r[55]),i[47]=D(r[60]),i[48]=D(r[21]),i[49]=D(r[34]),i[50]=D(r[37]),i[51]=D(r[47]),i[52]=D(r[50]),i[53]=D(r[56]),i[54]=D(r[59]),i[55]=D(r[61]),i[56]=D(r[35]),i[57]=D(r[36]),i[58]=D(r[48]),i[59]=D(r[49]),i[60]=D(r[57]),i[61]=D(r[58]),i[62]=D(r[62]),i[63]=D(r[63])}function Bt(r){const i=.5*Math.cos(.7853975),s=.5*Math.cos(3.14159/16),m=.5*Math.cos(3.14159/8),g=.5*Math.cos(3*3.14159/16),w=.5*Math.cos(5*3.14159/16),F=.5*Math.cos(3*3.14159/8),C=.5*Math.cos(7*3.14159/16);for(var z=new Array(4),k=new Array(4),B=new Array(4),N=new Array(4),we=0;we<8;++we){var W=we*8;z[0]=m*r[W+2],z[1]=F*r[W+2],z[2]=m*r[W+6],z[3]=F*r[W+6],k[0]=s*r[W+1]+g*r[W+3]+w*r[W+5]+C*r[W+7],k[1]=g*r[W+1]-C*r[W+3]-s*r[W+5]-w*r[W+7],k[2]=w*r[W+1]-s*r[W+3]+C*r[W+5]+g*r[W+7],k[3]=C*r[W+1]-w*r[W+3]+g*r[W+5]-s*r[W+7],B[0]=i*(r[W+0]+r[W+4]),B[3]=i*(r[W+0]-r[W+4]),B[1]=z[0]+z[3],B[2]=z[1]-z[2],N[0]=B[0]+B[1],N[1]=B[3]+B[2],N[2]=B[3]-B[2],N[3]=B[0]-B[1],r[W+0]=N[0]+k[0],r[W+1]=N[1]+k[1],r[W+2]=N[2]+k[2],r[W+3]=N[3]+k[3],r[W+4]=N[3]-k[3],r[W+5]=N[2]-k[2],r[W+6]=N[1]-k[1],r[W+7]=N[0]-k[0]}for(var Y=0;Y<8;++Y)z[0]=m*r[16+Y],z[1]=F*r[16+Y],z[2]=m*r[48+Y],z[3]=F*r[48+Y],k[0]=s*r[8+Y]+g*r[24+Y]+w*r[40+Y]+C*r[56+Y],k[1]=g*r[8+Y]-C*r[24+Y]-s*r[40+Y]-w*r[56+Y],k[2]=w*r[8+Y]-s*r[24+Y]+C*r[40+Y]+g*r[56+Y],k[3]=C*r[8+Y]-w*r[24+Y]+g*r[40+Y]-s*r[56+Y],B[0]=i*(r[Y]+r[32+Y]),B[3]=i*(r[Y]-r[32+Y]),B[1]=z[0]+z[3],B[2]=z[1]-z[2],N[0]=B[0]+B[1],N[1]=B[3]+B[2],N[2]=B[3]-B[2],N[3]=B[0]-B[1],r[0+Y]=N[0]+k[0],r[8+Y]=N[1]+k[1],r[16+Y]=N[2]+k[2],r[24+Y]=N[3]+k[3],r[32+Y]=N[3]-k[3],r[40+Y]=N[2]-k[2],r[48+Y]=N[1]-k[1],r[56+Y]=N[0]-k[0]}function ir(r){for(var i=0;i<64;++i){var s=r[0][i],m=r[1][i],g=r[2][i];r[0][i]=s+1.5747*g,r[1][i]=s-.1873*m-.4682*g,r[2][i]=s+1.8556*m}}function or(r,i,s){for(var m=0;m<64;++m)i[s+m]=mt.toHalfFloat(Ht(r[m]))}function Ht(r){return r<=1?Math.sign(r)*Math.pow(Math.abs(r),2.2):Math.sign(r)*Math.pow(I,Math.abs(r)-1)}function ot(r){return new DataView(r.array.buffer,r.offset.value,r.size)}function Je(r){var i=r.viewer.buffer.slice(r.offset.value,r.offset.value+r.size),s=new Uint8Array(Nt(i)),m=new Uint8Array(s.length);return Et(s),bt(s,m),new DataView(m.buffer)}function _t(r){var i=r.array.slice(r.offset.value,r.offset.value+r.size),s=Yt(i),m=new Uint8Array(s.length);return Et(s),bt(s,m),new DataView(m.buffer)}function sr(r){for(var i=r.viewer,s={value:r.offset.value},m=new Uint16Array(r.width*r.scanlineBlockSize*(r.channels*r.type)),g=new Uint8Array(8192),w=0,F=new Array(r.channels),C=0;C<r.channels;C++)F[C]={},F[C].start=w,F[C].end=F[C].start,F[C].nx=r.width,F[C].ny=r.lines,F[C].size=r.type,w+=F[C].nx*F[C].ny*F[C].size;var z=Te(i,s),k=Te(i,s);if(k>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(z<=k)for(var C=0;C<k-z+1;C++)g[C+z]=d(i,s);var B=new Uint16Array(65536),N=P(g,B),we=Se(i,s);Ut(r.array,i,s,we,m,w);for(var C=0;C<r.channels;++C)for(var W=F[C],Y=0;Y<F[C].size;++Y)rr(m,W.start+Y,W.nx,W.size,W.ny,W.nx*W.size,N);Lt(B,m,w);for(var Q=0,te=new Uint8Array(m.buffer.byteLength),ce=0;ce<r.lines;ce++)for(var he=0;he<r.channels;he++){var W=F[he],Me=W.nx*W.size,Ce=new Uint8Array(m.buffer,W.end*2,Me*2);te.set(Ce,Q),Q+=Me*2,W.end+=Me}return new DataView(te.buffer)}function jt(r){var i=r.array.slice(r.offset.value,r.offset.value+r.size),s=Yt(i);const m=r.lines*r.channels*r.width,g=r.type==1?new Uint16Array(m):new Uint32Array(m);let w=0,F=0;const C=new Array(4);for(let z=0;z<r.lines;z++)for(let k=0;k<r.channels;k++){let B=0;switch(r.type){case 1:C[0]=w,C[1]=C[0]+r.width,w=C[1]+r.width;for(let N=0;N<r.width;++N){const we=s[C[0]++]<<8|s[C[1]++];B+=we,g[F]=B,F++}break;case 2:C[0]=w,C[1]=C[0]+r.width,C[2]=C[1]+r.width,w=C[2]+r.width;for(let N=0;N<r.width;++N){const we=s[C[0]++]<<24|s[C[1]++]<<16|s[C[2]++]<<8;B+=we,g[F]=B,F++}break}}return new DataView(g.buffer)}function st(r){var i=r.viewer,s={value:r.offset.value},m=new Uint8Array(r.width*r.lines*(r.channels*r.type*2)),g={version:A(i,s),unknownUncompressedSize:A(i,s),unknownCompressedSize:A(i,s),acCompressedSize:A(i,s),dcCompressedSize:A(i,s),rleCompressedSize:A(i,s),rleUncompressedSize:A(i,s),rleRawSize:A(i,s),totalAcUncompressedCount:A(i,s),totalDcUncompressedCount:A(i,s),acCompression:A(i,s)};if(g.version<2)throw"EXRLoader.parse: "+xt.compression+" version "+g.version+" is unsupported";for(var w=new Array,F=Te(i,s)-2;F>0;){var C=lt(i.buffer,s),z=d(i,s),k=z>>2&3,B=(z>>4)-1,N=new Int8Array([B])[0],we=d(i,s);w.push({name:C,index:N,type:we,compression:k}),F-=C.length+3}for(var W=xt.channels,Y=new Array(r.channels),Q=0;Q<r.channels;++Q){var te=Y[Q]={},ce=W[Q];te.name=ce.name,te.compression=0,te.decoded=!1,te.type=ce.pixelType,te.pLinear=ce.pLinear,te.width=r.width,te.height=r.lines}for(var he={idx:new Array(3)},Me=0;Me<r.channels;++Me)for(var te=Y[Me],Q=0;Q<w.length;++Q){var Ce=w[Q];te.name==Ce.name&&(te.compression=Ce.compression,Ce.index>=0&&(he.idx[Ce.index]=Me),te.offset=Me)}if(g.acCompressedSize>0)switch(g.acCompression){case 0:var pe=new Uint16Array(g.totalAcUncompressedCount);Ut(r.array,i,s,g.acCompressedSize,pe,g.totalAcUncompressedCount);break;case 1:var fe=r.array.slice(s.value,s.value+g.totalAcUncompressedCount),Ge=Yt(fe),pe=new Uint16Array(Ge.buffer);s.value+=g.totalAcUncompressedCount;break}if(g.dcCompressedSize>0){var xe={array:r.array,offset:s,size:g.dcCompressedSize},Xe=new Uint16Array(_t(xe).buffer);s.value+=g.dcCompressedSize}if(g.rleRawSize>0){var fe=r.array.slice(s.value,s.value+g.rleCompressedSize),Ge=Yt(fe),St=Nt(Ge.buffer);s.value+=g.rleCompressedSize}for(var Pe=0,ue=new Array(Y.length),Q=0;Q<ue.length;++Q)ue[Q]=new Array;for(var Ie=0;Ie<r.lines;++Ie)for(var ge=0;ge<Y.length;++ge)ue[ge].push(Pe),Pe+=Y[ge].width*r.type*2;ar(he,ue,Y,pe,Xe,m);for(var Q=0;Q<Y.length;++Q){var te=Y[Q];if(!te.decoded)switch(te.compression){case 2:for(var se=0,Fe=0,Ie=0;Ie<r.lines;++Ie){for(var at=ue[Q][se],Ae=0;Ae<te.width;++Ae){for(var $e=0;$e<2*te.type;++$e)m[at++]=St[Fe+$e*te.width*te.height];Fe++}se++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(m.buffer)}function lt(r,i){for(var s=new Uint8Array(r),m=0;s[i.value+m]!=0;)m+=1;var g=new TextDecoder().decode(s.slice(i.value,i.value+m));return i.value=i.value+m+1,g}function lr(r,i,s){var m=new TextDecoder().decode(new Uint8Array(r).slice(i.value,i.value+s));return i.value=i.value+s,m}function Zt(r,i){var s=et(r,i),m=Se(r,i);return[s,m]}function cr(r,i){var s=Se(r,i),m=Se(r,i);return[s,m]}function et(r,i){var s=r.getInt32(i.value,!0);return i.value=i.value+4,s}function Se(r,i){var s=r.getUint32(i.value,!0);return i.value=i.value+4,s}function ct(r,i){var s=r[i.value];return i.value=i.value+1,s}function d(r,i){var s=r.getUint8(i.value);return i.value=i.value+1,s}const A=function(r,i){let s;return"getBigInt64"in DataView.prototype?s=Number(r.getBigInt64(i.value,!0)):s=r.getUint32(i.value+4,!0)+Number(r.getUint32(i.value,!0)<<32),i.value+=8,s};function G(r,i){var s=r.getFloat32(i.value,!0);return i.value+=4,s}function ae(r,i){return mt.toHalfFloat(G(r,i))}function D(r){var i=(r&31744)>>10,s=r&1023;return(r>>15?-1:1)*(i?i===31?s?NaN:1/0:Math.pow(2,i-15)*(1+s/1024):6103515625e-14*(s/1024))}function Te(r,i){var s=r.getUint16(i.value,!0);return i.value+=2,s}function Ze(r,i){return D(Te(r,i))}function Nr(r,i,s,m){for(var g=s.value,w=[];s.value<g+m-1;){var F=lt(i,s),C=et(r,s),z=d(r,s);s.value+=3;var k=et(r,s),B=et(r,s);w.push({name:F,pixelType:C,pLinear:z,xSampling:k,ySampling:B})}return s.value+=1,w}function Gt(r,i){var s=G(r,i),m=G(r,i),g=G(r,i),w=G(r,i),F=G(r,i),C=G(r,i),z=G(r,i),k=G(r,i);return{redX:s,redY:m,greenX:g,greenY:w,blueX:F,blueY:C,whiteX:z,whiteY:k}}function ke(r,i){var s=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],m=d(r,i);return s[m]}function ze(r,i){var s=Se(r,i),m=Se(r,i),g=Se(r,i),w=Se(r,i);return{xMin:s,yMin:m,xMax:g,yMax:w}}function tt(r,i){var s=["INCREASING_Y"],m=d(r,i);return s[m]}function rt(r,i){var s=G(r,i),m=G(r,i);return[s,m]}function nt(r,i){var s=G(r,i),m=G(r,i),g=G(r,i);return[s,m,g]}function ut(r,i,s,m,g){if(m==="string"||m==="stringvector"||m==="iccProfile")return lr(i,s,g);if(m==="chlist")return Nr(r,i,s,g);if(m==="chromaticities")return Gt(r,s);if(m==="compression")return ke(r,s);if(m==="box2i")return ze(r,s);if(m==="lineOrder")return tt(r,s);if(m==="float")return G(r,s);if(m==="v2f")return rt(r,s);if(m==="v3f")return nt(r,s);if(m==="int")return et(r,s);if(m==="rational")return Zt(r,s);if(m==="timecode")return cr(r,s);if(m==="preview")return s.value+=g,"skipped";s.value+=g}function Fn(r,i,s){const m={};if(r.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";m.version=r.getUint8(4);const g=r.getUint8(5);m.spec={singleTile:!!(g&2),longName:!!(g&4),deepFormat:!!(g&8),multiPart:!!(g&16)},s.value=8;for(var w=!0;w;){var F=lt(i,s);if(F==0)w=!1;else{var C=lt(i,s),z=Se(r,s),k=ut(r,i,s,C,z);k===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${C}'.`):m[F]=k}}if(g&-5)throw console.error("EXRHeader:",m),"THREE.EXRLoader: provided file is currently unsupported.";return m}function Dn(r,i,s,m,g){const w={size:0,viewer:i,array:s,offset:m,width:r.dataWindow.xMax-r.dataWindow.xMin+1,height:r.dataWindow.yMax-r.dataWindow.yMin+1,channels:r.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:r.channels[0].pixelType,uncompress:null,getter:null,format:null,[It?"colorSpace":"encoding"]:null};switch(r.compression){case"NO_COMPRESSION":w.lines=1,w.uncompress=ot;break;case"RLE_COMPRESSION":w.lines=1,w.uncompress=Je;break;case"ZIPS_COMPRESSION":w.lines=1,w.uncompress=_t;break;case"ZIP_COMPRESSION":w.lines=16,w.uncompress=_t;break;case"PIZ_COMPRESSION":w.lines=32,w.uncompress=sr;break;case"PXR24_COMPRESSION":w.lines=16,w.uncompress=jt;break;case"DWAA_COMPRESSION":w.lines=32,w.uncompress=st;break;case"DWAB_COMPRESSION":w.lines=256,w.uncompress=st;break;default:throw"EXRLoader.parse: "+r.compression+" is unsupported"}if(w.scanlineBlockSize=w.lines,w.type==1)switch(g){case Ve:w.getter=Ze,w.inputSize=2;break;case Oe:w.getter=Te,w.inputSize=2;break}else if(w.type==2)switch(g){case Ve:w.getter=G,w.inputSize=4;break;case Oe:w.getter=ae,w.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+w.type+" for "+r.compression+".";w.blockCount=(r.dataWindow.yMax+1)/w.scanlineBlockSize;for(var F=0;F<w.blockCount;F++)A(i,m);w.outputChannels=w.channels==3?4:w.channels;const C=w.width*w.height*w.outputChannels;switch(g){case Ve:w.byteArray=new Float32Array(C),w.channels<w.outputChannels&&w.byteArray.fill(1,0,C);break;case Oe:w.byteArray=new Uint16Array(C),w.channels<w.outputChannels&&w.byteArray.fill(15360,0,C);break;default:console.error("THREE.EXRLoader: unsupported type: ",g);break}return w.bytesPerLine=w.width*w.inputSize*w.channels,w.outputChannels==4?w.format=Ot:w.format=sa,It?w.colorSpace="srgb-linear":w.encoding=3e3,w}const Wt=new DataView(e),Un=new Uint8Array(e),Mt={value:0},xt=Fn(Wt,e,Mt),ne=Dn(xt,Wt,Un,Mt,this.type),kr={value:0},Ln={R:0,G:1,B:2,A:3,Y:0};for(let r=0;r<ne.height/ne.scanlineBlockSize;r++){const i=Se(Wt,Mt);ne.size=Se(Wt,Mt),ne.lines=i+ne.scanlineBlockSize>ne.height?ne.height-i:ne.scanlineBlockSize;const m=ne.size<ne.lines*ne.bytesPerLine?ne.uncompress(ne):ot(ne);Mt.value+=ne.size;for(let g=0;g<ne.scanlineBlockSize;g++){const w=g+r*ne.scanlineBlockSize;if(w>=ne.height)break;for(let F=0;F<ne.channels;F++){const C=Ln[xt.channels[F].name];for(let z=0;z<ne.width;z++){kr.value=(g*(ne.channels*ne.width)+F*ne.width+z)*ne.inputSize;const k=(ne.height-1-w)*(ne.width*ne.outputChannels)+z*ne.outputChannels+C;ne.byteArray[k]=ne.getter(m,kr)}}}}return{header:xt,width:ne.width,height:ne.height,data:ne.byteArray,format:ne.format,[It?"colorSpace":"encoding"]:ne[It?"colorSpace":"encoding"],type:this.type}}setDataType(e){return this.type=e,this}load(e,a,t,o){function l(f,c){It?f.colorSpace=c.colorSpace:f.encoding=c.encoding,f.minFilter=We,f.magFilter=We,f.generateMipmaps=!1,f.flipY=!1,a&&a(f,c)}return super.load(e,l,t,o)}}function En(n,e,a,t){const o=class extends wt{constructor(f={}){const c=Object.entries(n);super({uniforms:c.reduce((p,[u,M])=>{const x=la.clone({[u]:{value:M}});return{...p,...x}},{}),vertexShader:e,fragmentShader:a}),this.key="",c.forEach(([p])=>Object.defineProperty(this,p,{get:()=>this.uniforms[p].value,set:u=>this.uniforms[p].value=u})),Object.assign(this,f)}};return o.key=Ct.generateUUID(),o}const Ei=()=>parseInt(ca.replace(/\D+/g,"")),bn=Ei(),bi=h.forwardRef(({makeDefault:n,camera:e,regress:a,domElement:t,enableDamping:o=!0,keyEvents:l=!1,onChange:f,onStart:c,onEnd:p,...u},M)=>{const x=Ee(v=>v.invalidate),y=Ee(v=>v.camera),L=Ee(v=>v.gl),T=Ee(v=>v.events),b=Ee(v=>v.setEvents),O=Ee(v=>v.set),S=Ee(v=>v.get),R=Ee(v=>v.performance),Z=e||y,H=t||T.connected||L.domElement,_=h.useMemo(()=>new mi(Z),[Z]);return it(()=>{_.enabled&&_.update()},-1),h.useEffect(()=>(l&&_.connect(l===!0?H:l),_.connect(H),()=>void _.dispose()),[l,H,a,_,x]),h.useEffect(()=>{const v=I=>{x(),a&&R.regress(),f&&f(I)},U=I=>{c&&c(I)},E=I=>{p&&p(I)};return _.addEventListener("change",v),_.addEventListener("start",U),_.addEventListener("end",E),()=>{_.removeEventListener("start",U),_.removeEventListener("end",E),_.removeEventListener("change",v)}},[f,c,p,_,x,b]),h.useEffect(()=>{if(n){const v=S().controls;return O({controls:_}),()=>O({controls:v})}},[n,_]),h.createElement("primitive",je({ref:M,object:_,enableDamping:o},u))}),_i=h.forwardRef(function({children:e,disable:a,disableX:t,disableY:o,disableZ:l,left:f,right:c,top:p,bottom:u,front:M,back:x,onCentered:y,precise:L=!0,cacheKey:T=0,...b},O){const S=h.useRef(null),R=h.useRef(null),Z=h.useRef(null);return h.useLayoutEffect(()=>{R.current.matrixWorld.identity();const H=new ln().setFromObject(Z.current,L),_=new re,v=new ua,U=H.max.x-H.min.x,E=H.max.y-H.min.y,I=H.max.z-H.min.z;H.getCenter(_),H.getBoundingSphere(v);const P=p?E/2:u?-E/2:0,V=f?-U/2:c?U/2:0,q=M?I/2:x?-I/2:0;R.current.position.set(a||t?0:-_.x+V,a||o?0:-_.y+P,a||l?0:-_.z+q),typeof y<"u"&&y({parent:S.current.parent,container:S.current,width:U,height:E,depth:I,boundingBox:H,boundingSphere:v,center:_,verticalAlignment:P,horizontalAlignment:V,depthAlignment:q})},[T,y,p,f,M,a,t,o,l,L,c,u,x]),h.useImperativeHandle(O,()=>S.current,[]),h.createElement("group",je({ref:S},b),h.createElement("group",{ref:R},h.createElement("group",{ref:Z},e)))}),Mi=3e3,xi=3001,Si=En({},"void main() { }","void main() { gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0); discard;  }");var De=function(n){return n[n.NONE=0]="NONE",n[n.START=1]="START",n[n.ACTIVE=2]="ACTIVE",n}(De||{});const ft=n=>n&&n.isOrthographicCamera,Ii=n=>n&&n.isBox3,Ri=n=>1-Math.exp(-5*n)+.007*n,_n=h.createContext(null);function Ti({children:n,maxDuration:e=1,margin:a=1.2,observe:t,fit:o,clip:l,interpolateFunc:f=Ri,onFit:c}){const p=h.useRef(null),{camera:u,size:M,invalidate:x}=Ee(),y=Ee(_=>_.controls),L=h.useRef(c);L.current=c;const T=h.useRef({camPos:new re,camRot:new Tt,camZoom:1}),b=h.useRef({camPos:void 0,camRot:void 0,camZoom:void 0,camUp:void 0,target:void 0}),O=h.useRef(De.NONE),S=h.useRef(0),[R]=h.useState(()=>new ln),Z=h.useMemo(()=>{function _(){const v=R.getSize(new re),U=R.getCenter(new re),E=Math.max(v.x,v.y,v.z),I=ft(u)?E*4:E/(2*Math.atan(Math.PI*u.fov/360)),P=ft(u)?E*4:I/u.aspect,V=a*Math.max(I,P);return{box:R,size:v,center:U,distance:V}}return{getSize:_,refresh(v){if(Ii(v))R.copy(v);else{const U=v||p.current;if(!U)return this;U.updateWorldMatrix(!0,!0),R.setFromObject(U)}if(R.isEmpty()){const U=u.position.length()||10;R.setFromCenterAndSize(new re,new re(U,U,U))}return T.current.camPos.copy(u.position),T.current.camRot.copy(u.quaternion),ft(u)&&(T.current.camZoom=u.zoom),b.current.camPos=void 0,b.current.camRot=void 0,b.current.camZoom=void 0,b.current.camUp=void 0,b.current.target=void 0,this},reset(){const{center:v,distance:U}=_(),E=u.position.clone().sub(v).normalize();b.current.camPos=v.clone().addScaledVector(E,U),b.current.target=v.clone();const I=new dr().lookAt(b.current.camPos,b.current.target,u.up);return b.current.camRot=new Tt().setFromRotationMatrix(I),O.current=De.START,S.current=0,this},moveTo(v){return b.current.camPos=Array.isArray(v)?new re(...v):v.clone(),O.current=De.START,S.current=0,this},lookAt({target:v,up:U}){b.current.target=Array.isArray(v)?new re(...v):v.clone(),U?b.current.camUp=Array.isArray(U)?new re(...U):U.clone():b.current.camUp=u.up.clone();const E=new dr().lookAt(b.current.camPos||u.position,b.current.target,b.current.camUp);return b.current.camRot=new Tt().setFromRotationMatrix(E),O.current=De.START,S.current=0,this},to({position:v,target:U}){return this.moveTo(v).lookAt({target:U})},fit(){if(!ft(u))return this.reset();let v=0,U=0;const E=[new re(R.min.x,R.min.y,R.min.z),new re(R.min.x,R.max.y,R.min.z),new re(R.min.x,R.min.y,R.max.z),new re(R.min.x,R.max.y,R.max.z),new re(R.max.x,R.max.y,R.max.z),new re(R.max.x,R.max.y,R.min.z),new re(R.max.x,R.min.y,R.max.z),new re(R.max.x,R.min.y,R.min.z)],I=b.current.camPos||u.position,P=b.current.target||(y==null?void 0:y.target),V=b.current.camUp||u.up,q=P?new dr().lookAt(I,P,V).setPosition(I).invert():u.matrixWorldInverse;for(const ee of E)ee.applyMatrix4(q),v=Math.max(v,Math.abs(ee.y)),U=Math.max(U,Math.abs(ee.x));v*=2,U*=2;const $=(u.top-u.bottom)/v,j=(u.right-u.left)/U;return b.current.camZoom=Math.min($,j)/a,O.current=De.START,S.current=0,L.current&&L.current(this.getSize()),this},clip(){const{distance:v}=_();return u.near=v/100,u.far=v*100,u.updateProjectionMatrix(),y&&(y.maxDistance=v*10,y.update()),x(),this}}},[R,u,y,a,x]);h.useLayoutEffect(()=>{if(y){const _=()=>{if(y&&b.current.target&&O.current!==De.NONE){const v=new re().setFromMatrixColumn(u.matrix,2),U=T.current.camPos.distanceTo(y.target),E=(b.current.camPos||T.current.camPos).distanceTo(b.current.target),I=(1-S.current)*U+S.current*E;y.target.copy(u.position).addScaledVector(v,-I),y.update()}O.current=De.NONE};return y.addEventListener("start",_),()=>y.removeEventListener("start",_)}},[y]);const H=h.useRef(0);return h.useLayoutEffect(()=>{(t||H.current++===0)&&(Z.refresh(),o&&Z.reset().fit(),l&&Z.clip())},[M,l,o,t,u,y]),it((_,v)=>{if(O.current===De.START)O.current=De.ACTIVE,x();else if(O.current===De.ACTIVE){if(S.current+=v/e,S.current>=1)b.current.camPos&&u.position.copy(b.current.camPos),b.current.camRot&&u.quaternion.copy(b.current.camRot),b.current.camUp&&u.up.copy(b.current.camUp),b.current.camZoom&&ft(u)&&(u.zoom=b.current.camZoom),u.updateMatrixWorld(),u.updateProjectionMatrix(),y&&b.current.target&&(y.target.copy(b.current.target),y.update()),O.current=De.NONE;else{const U=f(S.current);b.current.camPos&&u.position.lerpVectors(T.current.camPos,b.current.camPos,U),b.current.camRot&&u.quaternion.slerpQuaternions(T.current.camRot,b.current.camRot,U),b.current.camUp&&u.up.set(0,1,0).applyQuaternion(u.quaternion),b.current.camZoom&&ft(u)&&(u.zoom=(1-U)*T.current.camZoom+U*b.current.camZoom),u.updateMatrixWorld(),u.updateProjectionMatrix()}x()}}),h.createElement("group",{ref:p},h.createElement(_n.Provider,{value:Z},n))}function Ci(){return h.useContext(_n)}const Ai=h.forwardRef(({children:n,enabled:e=!0,speed:a=1,rotationIntensity:t=1,floatIntensity:o=1,floatingRange:l=[-.1,.1],autoInvalidate:f=!1,...c},p)=>{const u=h.useRef(null);h.useImperativeHandle(p,()=>u.current,[]);const M=h.useRef(Math.random()*1e4);return it(x=>{var y,L;if(!e||a===0)return;f&&x.invalidate();const T=M.current+x.clock.elapsedTime;u.current.rotation.x=Math.cos(T/4*a)/8*t,u.current.rotation.y=Math.sin(T/4*a)/8*t,u.current.rotation.z=Math.sin(T/4*a)/20*t;let b=Math.sin(T/4*a)/10;b=Ct.mapLinear(b,-.1,.1,(y=l==null?void 0:l[0])!==null&&y!==void 0?y:-.1,(L=l==null?void 0:l[1])!==null&&L!==void 0?L:.1),u.current.position.y=b*o,u.current.updateMatrix()}),h.createElement("group",c,h.createElement("group",{ref:u,matrixAutoUpdate:!1},n))}),Mn=(n,e,a)=>{let t;switch(n){case _r:t=new Uint8ClampedArray(e*a*4);break;case Oe:t=new Uint16Array(e*a*4);break;case ga:t=new Uint32Array(e*a*4);break;case va:t=new Int8Array(e*a*4);break;case ma:t=new Int16Array(e*a*4);break;case pa:t=new Int32Array(e*a*4);break;case Ve:t=new Float32Array(e*a*4);break;default:throw new Error("Unsupported data type")}return t};let Vt;const Oi=(n,e,a,t)=>{if(Vt!==void 0)return Vt;const o=new yt(1,1,t);e.setRenderTarget(o);const l=new er(new Ir,new fa({color:16777215}));e.render(l,a),e.setRenderTarget(null);const f=Mn(n,o.width,o.height);return e.readRenderTargetPixels(o,0,0,o.width,o.height,f),o.dispose(),l.geometry.dispose(),l.material.dispose(),Vt=f[0]!==0,Vt};class Tr{constructor(e){var a,t,o,l,f,c,p,u,M,x,y,L,T,b,O,S;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(Z){throw this._renderer.setRenderTarget(null),Z}this._renderer.setRenderTarget(null)},this._width=e.width,this._height=e.height,this._type=e.type,this._colorSpace=e.colorSpace;const R={format:Ot,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:((a=e.renderTargetOptions)===null||a===void 0?void 0:a.anisotropy)!==void 0?(t=e.renderTargetOptions)===null||t===void 0?void 0:t.anisotropy:1,generateMipmaps:((o=e.renderTargetOptions)===null||o===void 0?void 0:o.generateMipmaps)!==void 0?(l=e.renderTargetOptions)===null||l===void 0?void 0:l.generateMipmaps:!1,magFilter:((f=e.renderTargetOptions)===null||f===void 0?void 0:f.magFilter)!==void 0?(c=e.renderTargetOptions)===null||c===void 0?void 0:c.magFilter:We,minFilter:((p=e.renderTargetOptions)===null||p===void 0?void 0:p.minFilter)!==void 0?(u=e.renderTargetOptions)===null||u===void 0?void 0:u.minFilter:We,samples:((M=e.renderTargetOptions)===null||M===void 0?void 0:M.samples)!==void 0?(x=e.renderTargetOptions)===null||x===void 0?void 0:x.samples:void 0,wrapS:((y=e.renderTargetOptions)===null||y===void 0?void 0:y.wrapS)!==void 0?(L=e.renderTargetOptions)===null||L===void 0?void 0:L.wrapS:qe,wrapT:((T=e.renderTargetOptions)===null||T===void 0?void 0:T.wrapT)!==void 0?(b=e.renderTargetOptions)===null||b===void 0?void 0:b.wrapT:qe};if(this._material=e.material,e.renderer?this._renderer=e.renderer:(this._renderer=Tr.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new cn,this._camera=new Kt,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!Oi(this._type,this._renderer,this._camera,R)){let Z;switch(this._type){case Oe:Z=this._renderer.extensions.has("EXT_color_buffer_float")?Ve:void 0;break}Z!==void 0?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${Ve}`),this._type=Z):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new er(new Ir,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new yt(this.width,this.height,R),this._renderTarget.texture.mapping=((O=e.renderTargetOptions)===null||O===void 0?void 0:O.mapping)!==void 0?(S=e.renderTargetOptions)===null||S===void 0?void 0:S.mapping:Qt}static instantiateRenderer(){const e=new da;return e.setSize(128,128),e}toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const e=Mn(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,e),e}toDataTexture(e){const a=new ha(this.toArray(),this.width,this.height,Ot,this._type,(e==null?void 0:e.mapping)||Qt,(e==null?void 0:e.wrapS)||qe,(e==null?void 0:e.wrapT)||qe,(e==null?void 0:e.magFilter)||We,(e==null?void 0:e.minFilter)||We,(e==null?void 0:e.anisotropy)||1,br);return a.generateMipmaps=(e==null?void 0:e.generateMipmaps)!==void 0?e==null?void 0:e.generateMipmaps:!1,a}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(e){this.disposeOnDemandRenderer(),e&&this.renderTarget.dispose(),this.material instanceof wt&&Object.values(this.material.uniforms).forEach(a=>{a.value instanceof vt&&a.value.dispose()}),Object.values(this.material).forEach(a=>{a instanceof vt&&a.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(e){this._width=e,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(e){this._height=e,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(e){this._renderTarget=e,this._width=e.width,this._height=e.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}const Pi=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,Fi=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class Di extends wt{constructor({gamma:e,offsetHdr:a,offsetSdr:t,gainMapMin:o,gainMapMax:l,maxDisplayBoost:f,hdrCapacityMin:c,hdrCapacityMax:p,sdr:u,gainMap:M}){super({name:"GainMapDecoderMaterial",vertexShader:Pi,fragmentShader:Fi,uniforms:{sdr:{value:u},gainMap:{value:M},gamma:{value:new re(1/e[0],1/e[1],1/e[2])},offsetHdr:{value:new re().fromArray(a)},offsetSdr:{value:new re().fromArray(t)},gainMapMin:{value:new re().fromArray(o)},gainMapMax:{value:new re().fromArray(l)},weightFactor:{value:(Math.log2(f)-c)/(p-c)}},blending:ba,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=f,this._hdrCapacityMin=c,this._hdrCapacityMax=p,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(e){this.uniforms.sdr.value=e}get gainMap(){return this.uniforms.gainMap.value}set gainMap(e){this.uniforms.gainMap.value=e}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(e){this.uniforms.offsetHdr.value.fromArray(e)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(e){this.uniforms.offsetSdr.value.fromArray(e)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(e){this.uniforms.gainMapMin.value.fromArray(e)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(e){this.uniforms.gainMapMax.value.fromArray(e)}get gamma(){const e=this.uniforms.gamma.value;return[1/e.x,1/e.y,1/e.z]}set gamma(e){const a=this.uniforms.gamma.value;a.x=1/e[0],a.y=1/e[1],a.z=1/e[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(e){this._hdrCapacityMin=e,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(e){this._hdrCapacityMax=e,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(e){this._maxDisplayBoost=Math.max(1,Math.min(65504,e)),this.calculateWeight()}calculateWeight(){const e=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,e))}}class xn extends Error{}class Sn extends Error{}const Rt=(n,e,a)=>{const t=new RegExp(`${e}="([^"]*)"`,"i").exec(n);if(t)return t[1];const o=new RegExp(`<${e}[^>]*>([\\s\\S]*?)</${e}>`,"i").exec(n);if(o){const l=o[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return l&&l.length===3?l.map(f=>f.replace(/<\/?rdf:li>/g,"")):o[1].trim()}if(a!==void 0)return a;throw new Error(`Can't find ${e} in gainmap metadata`)},Ui=n=>{let e;typeof TextDecoder<"u"?e=new TextDecoder().decode(n):e=n.toString();let a=e.indexOf("<x:xmpmeta");for(;a!==-1;){const t=e.indexOf("x:xmpmeta>",a),o=e.slice(a,t+10);try{const l=Rt(o,"hdrgm:GainMapMin","0"),f=Rt(o,"hdrgm:GainMapMax"),c=Rt(o,"hdrgm:Gamma","1"),p=Rt(o,"hdrgm:OffsetSDR","0.015625"),u=Rt(o,"hdrgm:OffsetHDR","0.015625"),M=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(o),x=M?M[1]:"0",y=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(o);if(!y)throw new Error("Incomplete gainmap metadata");const L=y[1];return{gainMapMin:Array.isArray(l)?l.map(T=>parseFloat(T)):[parseFloat(l),parseFloat(l),parseFloat(l)],gainMapMax:Array.isArray(f)?f.map(T=>parseFloat(T)):[parseFloat(f),parseFloat(f),parseFloat(f)],gamma:Array.isArray(c)?c.map(T=>parseFloat(T)):[parseFloat(c),parseFloat(c),parseFloat(c)],offsetSdr:Array.isArray(p)?p.map(T=>parseFloat(T)):[parseFloat(p),parseFloat(p),parseFloat(p)],offsetHdr:Array.isArray(u)?u.map(T=>parseFloat(T)):[parseFloat(u),parseFloat(u),parseFloat(u)],hdrCapacityMin:parseFloat(x),hdrCapacityMax:parseFloat(L)}}catch{}a=e.indexOf("<x:xmpmeta",t)}};class Li{constructor(e){this.options={debug:e&&e.debug!==void 0?e.debug:!1,extractFII:e&&e.extractFII!==void 0?e.extractFII:!0,extractNonFII:e&&e.extractNonFII!==void 0?e.extractNonFII:!0}}extract(e){return new Promise((a,t)=>{const o=this.options.debug,l=new DataView(e.buffer);if(l.getUint16(0)!==65496){t(new Error("Not a valid jpeg"));return}const f=l.byteLength;let c=2,p=0,u;for(;c<f;){if(++p>250){t(new Error(`Found no marker after ${p} loops 😵`));return}if(l.getUint8(c)!==255){t(new Error(`Not a valid marker at offset 0x${c.toString(16)}, found: 0x${l.getUint8(c).toString(16)}`));return}if(u=l.getUint8(c+1),o&&console.log(`Marker: ${u.toString(16)}`),u===226){o&&console.log("Found APP2 marker (0xffe2)");const M=c+4;if(l.getUint32(M)===1297106432){const x=M+4;let y;if(l.getUint16(x)===18761)y=!1;else if(l.getUint16(x)===19789)y=!0;else{t(new Error("No valid endianness marker found in TIFF header"));return}if(l.getUint16(x+2,!y)!==42){t(new Error("Not valid TIFF data! (no 0x002A marker)"));return}const L=l.getUint32(x+4,!y);if(L<8){t(new Error("Not valid TIFF data! (First offset less than 8)"));return}const T=x+L,b=l.getUint16(T,!y),O=T+2;let S=0;for(let _=O;_<O+12*b;_+=12)l.getUint16(_,!y)===45057&&(S=l.getUint32(_+8,!y));const Z=T+2+b*12+4,H=[];for(let _=Z;_<Z+S*16;_+=16){const v={MPType:l.getUint32(_,!y),size:l.getUint32(_+4,!y),dataOffset:l.getUint32(_+8,!y),dependantImages:l.getUint32(_+12,!y),start:-1,end:-1,isFII:!1};v.dataOffset?(v.start=x+v.dataOffset,v.isFII=!1):(v.start=0,v.isFII=!0),v.end=v.start+v.size,H.push(v)}if(this.options.extractNonFII&&H.length){const _=new Blob([l]),v=[];for(const U of H){if(U.isFII&&!this.options.extractFII)continue;const E=_.slice(U.start,U.end+1,"image/jpeg");v.push(E)}a(v)}}}c+=2+l.getUint16(c+2)}})}}const Ni=async n=>{const e=Ui(n);if(!e)throw new Sn("Gain map XMP metadata not found");const t=await new Li({extractFII:!0,extractNonFII:!0}).extract(n);if(t.length!==2)throw new xn("Gain map recovery image not found");return{sdr:new Uint8Array(await t[0].arrayBuffer()),gainMap:new Uint8Array(await t[1].arrayBuffer()),metadata:e}},Jr=n=>new Promise((e,a)=>{const t=document.createElement("img");t.onload=()=>{e(t)},t.onerror=o=>{a(o)},t.src=URL.createObjectURL(n)});class In extends wa{constructor(e,a){super(a),e&&(this._renderer=e),this._internalLoadingManager=new ya}setRenderer(e){return this._renderer=e,this}setRenderTargetOptions(e){return this._renderTargetOptions=e,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: An existing WebGL Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const e=new Di({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new vt,sdr:new vt});return new Tr({width:16,height:16,type:Oe,colorSpace:br,material:e,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(e,a,t,o){const l=o?new Blob([o],{type:"image/jpeg"}):void 0,f=new Blob([t],{type:"image/jpeg"});let c,p,u=!1;if(typeof createImageBitmap>"u"){const y=await Promise.all([l?Jr(l):Promise.resolve(void 0),Jr(f)]);p=y[0],c=y[1],u=!0}else{const y=await Promise.all([l?createImageBitmap(l,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(f,{imageOrientation:"flipY"})]);p=y[0],c=y[1]}const M=new vt(p||new ImageData(2,2),Qt,qe,qe,We,Hr,Ot,_r,1,br);M.flipY=u,M.needsUpdate=!0;const x=new vt(c,Qt,qe,qe,We,Hr,Ot,_r,1,Ea);x.flipY=u,x.needsUpdate=!0,e.width=c.width,e.height=c.height,e.material.gainMap=M,e.material.sdr=x,e.material.gainMapMin=a.gainMapMin,e.material.gainMapMax=a.gainMapMax,e.material.offsetHdr=a.offsetHdr,e.material.offsetSdr=a.offsetSdr,e.material.gamma=a.gamma,e.material.hdrCapacityMin=a.hdrCapacityMin,e.material.hdrCapacityMax=a.hdrCapacityMax,e.material.maxDisplayBoost=Math.pow(2,a.hdrCapacityMax),e.material.needsUpdate=!0,e.render()}}class ki extends In{load([e,a,t],o,l,f){const c=this.prepareQuadRenderer();let p,u,M;const x=async()=>{if(p&&u&&M){try{await this.render(c,M,p,u)}catch(I){this.manager.itemError(e),this.manager.itemError(a),this.manager.itemError(t),typeof f=="function"&&f(I),c.disposeOnDemandRenderer();return}typeof o=="function"&&o(c),this.manager.itemEnd(e),this.manager.itemEnd(a),this.manager.itemEnd(t),c.disposeOnDemandRenderer()}};let y=!0,L=0,T=0,b=!0,O=0,S=0,R=!0,Z=0,H=0;const _=()=>{if(typeof l=="function"){const I=L+O+Z,P=T+S+H,V=y&&b&&R;l(new ProgressEvent("progress",{lengthComputable:V,loaded:P,total:I}))}};this.manager.itemStart(e),this.manager.itemStart(a),this.manager.itemStart(t);const v=new qt(this._internalLoadingManager);v.setResponseType("arraybuffer"),v.setRequestHeader(this.requestHeader),v.setPath(this.path),v.setWithCredentials(this.withCredentials),v.load(e,async I=>{if(typeof I=="string")throw new Error("Invalid sdr buffer");p=I,await x()},I=>{y=I.lengthComputable,T=I.loaded,L=I.total,_()},I=>{this.manager.itemError(e),typeof f=="function"&&f(I)});const U=new qt(this._internalLoadingManager);U.setResponseType("arraybuffer"),U.setRequestHeader(this.requestHeader),U.setPath(this.path),U.setWithCredentials(this.withCredentials),U.load(a,async I=>{if(typeof I=="string")throw new Error("Invalid gainmap buffer");u=I,await x()},I=>{b=I.lengthComputable,S=I.loaded,O=I.total,_()},I=>{this.manager.itemError(a),typeof f=="function"&&f(I)});const E=new qt(this._internalLoadingManager);return E.setRequestHeader(this.requestHeader),E.setPath(this.path),E.setWithCredentials(this.withCredentials),E.load(t,async I=>{if(typeof I!="string")throw new Error("Invalid metadata string");M=JSON.parse(I),await x()},I=>{R=I.lengthComputable,H=I.loaded,Z=I.total,_()},I=>{this.manager.itemError(t),typeof f=="function"&&f(I)}),c}}class zi extends In{load(e,a,t,o){const l=this.prepareQuadRenderer(),f=new qt(this._internalLoadingManager);return f.setResponseType("arraybuffer"),f.setRequestHeader(this.requestHeader),f.setPath(this.path),f.setWithCredentials(this.withCredentials),this.manager.itemStart(e),f.load(e,async c=>{if(typeof c=="string")throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const p=new Uint8Array(c);let u,M,x;try{const y=await Ni(p);u=y.sdr,M=y.gainMap,x=y.metadata}catch(y){if(y instanceof Sn||y instanceof xn)console.warn(`Failure to reconstruct an HDR image from ${e}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),x={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},u=p;else throw y}try{await this.render(l,x,u,M)}catch(y){this.manager.itemError(e),typeof o=="function"&&o(y),l.disposeOnDemandRenderer();return}typeof a=="function"&&a(l),this.manager.itemEnd(e),l.disposeOnDemandRenderer()},t,c=>{this.manager.itemError(e),typeof o=="function"&&o(c)}),l}}const Pt={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},Rn="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",gt=n=>Array.isArray(n),Cr=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function tr({files:n=Cr,path:e="",preset:a=void 0,encoding:t=void 0,extensions:o}={}){let l=null,f=!1;a&&(Ar(a),n=Pt[a],e=Rn),f=gt(n);const{extension:c,isCubemap:p}=Or(n);if(l=Pr(c),!l)throw new Error("useEnvironment: Unrecognized file extension: "+n);const u=Ee(L=>L.gl);h.useLayoutEffect(()=>{if(c!=="webp"&&c!=="jpg"&&c!=="jpeg")return;function L(){Jt.clear(l,f?[n]:n)}u.domElement.addEventListener("webglcontextlost",L,{once:!0})},[n,u.domElement]);const M=Jt(l,f?[n]:n,L=>{(c==="webp"||c==="jpg"||c==="jpeg")&&L.setRenderer(u),L.setPath==null||L.setPath(e),o&&o(L)});let x=f?M[0]:M;if(c==="jpg"||c==="jpeg"||c==="webp"){var y;x=(y=x.renderTarget)==null?void 0:y.texture}return x.mapping=p?_a:Ma,"colorSpace"in x?x.colorSpace=t??p?"srgb":"srgb-linear":x.encoding=t??p?xi:Mi,x}const Bi={files:Cr,path:"",preset:void 0,extensions:void 0};tr.preload=n=>{const e={...Bi,...n};let{files:a,path:t=""}=e;const{preset:o,extensions:l}=e;o&&(Ar(o),a=Pt[o],t=Rn);const{extension:f}=Or(a);if(f==="webp"||f==="jpg"||f==="jpeg")throw new Error("useEnvironment: Preloading gainmaps is not supported");const c=Pr(f);if(!c)throw new Error("useEnvironment: Unrecognized file extension: "+a);Jt.preload(c,gt(a)?[a]:a,p=>{p.setPath==null||p.setPath(t),l&&l(p)})};const Hi={files:Cr,preset:void 0};tr.clear=n=>{const e={...Hi,...n};let{files:a}=e;const{preset:t}=e;t&&(Ar(t),a=Pt[t]);const{extension:o}=Or(a),l=Pr(o);if(!l)throw new Error("useEnvironment: Unrecognized file extension: "+a);Jt.clear(l,gt(a)?[a]:a)};function Ar(n){if(!(n in Pt))throw new Error("Preset must be one of: "+Object.keys(Pt).join(", "))}function Or(n){var e;const a=gt(n)&&n.length===6,t=gt(n)&&n.length===3&&n.some(f=>f.endsWith("json")),o=gt(n)?n[0]:n;return{extension:a?"cube":t?"webp":o.startsWith("data:application/exr")?"exr":o.startsWith("data:application/hdr")?"hdr":o.startsWith("data:image/jpeg")?"jpg":(e=o.split(".").pop())==null||(e=e.split("?"))==null||(e=e.shift())==null?void 0:e.toLowerCase(),isCubemap:a,isGainmap:t}}function Pr(n){return n==="cube"?xa:n==="hdr"?wi:n==="exr"?yi:n==="jpg"||n==="jpeg"?zi:n==="webp"?ki:null}const ji=n=>n.current&&n.current.isScene,Zi=n=>ji(n)?n.current:n;function Fr(n,e,a,t,o={}){var l,f,c,p;o={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...o};const u=Zi(e||a),M=u.background,x=u.environment,y={backgroundBlurriness:u.backgroundBlurriness,backgroundIntensity:u.backgroundIntensity,backgroundRotation:(l=(f=u.backgroundRotation)==null||f.clone==null?void 0:f.clone())!==null&&l!==void 0?l:[0,0,0],environmentIntensity:u.environmentIntensity,environmentRotation:(c=(p=u.environmentRotation)==null||p.clone==null?void 0:p.clone())!==null&&c!==void 0?c:[0,0,0]};return n!=="only"&&(u.environment=t),n&&(u.background=t),jr(u,o),()=>{n!=="only"&&(u.environment=x),n&&(u.background=M),jr(u,y)}}function Dr({scene:n,background:e=!1,map:a,...t}){const o=Ee(l=>l.scene);return h.useLayoutEffect(()=>{if(a)return Fr(e,n,o,a,t)}),null}function Tn({background:n=!1,scene:e,blur:a,backgroundBlurriness:t,backgroundIntensity:o,backgroundRotation:l,environmentIntensity:f,environmentRotation:c,...p}){const u=tr(p),M=Ee(x=>x.scene);return h.useLayoutEffect(()=>Fr(n,e,M,u,{backgroundBlurriness:a??t,backgroundIntensity:o,backgroundRotation:l,environmentIntensity:f,environmentRotation:c})),h.useEffect(()=>()=>{u.dispose()},[u]),null}function Gi({children:n,near:e=.1,far:a=1e3,resolution:t=256,frames:o=1,map:l,background:f=!1,blur:c,backgroundBlurriness:p,backgroundIntensity:u,backgroundRotation:M,environmentIntensity:x,environmentRotation:y,scene:L,files:T,path:b,preset:O=void 0,extensions:S}){const R=Ee(E=>E.gl),Z=Ee(E=>E.scene),H=h.useRef(null),[_]=h.useState(()=>new cn),v=h.useMemo(()=>{const E=new Sa(t);return E.texture.type=Oe,E},[t]);h.useEffect(()=>()=>{v.dispose()},[v]),h.useLayoutEffect(()=>{if(o===1){const E=R.autoClear;R.autoClear=!0,H.current.update(R,_),R.autoClear=E}return Fr(f,L,Z,v.texture,{backgroundBlurriness:c??p,backgroundIntensity:u,backgroundRotation:M,environmentIntensity:x,environmentRotation:y})},[n,_,v.texture,L,Z,f,o,R]);let U=1;return it(()=>{if(o===1/0||U<o){const E=R.autoClear;R.autoClear=!0,H.current.update(R,_),R.autoClear=E,U++}}),h.createElement(h.Fragment,null,Ia(h.createElement(h.Fragment,null,n,h.createElement("cubeCamera",{ref:H,args:[e,a,v]}),T||O?h.createElement(Tn,{background:!0,files:T,preset:O,path:b,extensions:S}):l?h.createElement(Dr,{background:!0,map:l,extensions:S}):null),_))}function Wi(n){var e,a,t,o;const l=tr(n),f=n.map||l;h.useMemo(()=>Sr({GroundProjectedEnvImpl:si}),[]),h.useEffect(()=>()=>{l.dispose()},[l]);const c=h.useMemo(()=>[f],[f]),p=(e=n.ground)==null?void 0:e.height,u=(a=n.ground)==null?void 0:a.radius,M=(t=(o=n.ground)==null?void 0:o.scale)!==null&&t!==void 0?t:1e3;return h.createElement(h.Fragment,null,h.createElement(Dr,je({},n,{map:f})),h.createElement("groundProjectedEnvImpl",{args:c,scale:M,height:p,radius:u}))}function Cn(n){return n.ground?h.createElement(Wi,n):n.map?h.createElement(Dr,n):n.children?h.createElement(Gi,n):h.createElement(Tn,n)}const Yi=h.forwardRef(({scale:n=10,frames:e=1/0,opacity:a=1,width:t=1,height:o=1,blur:l=1,near:f=0,far:c=10,resolution:p=512,smooth:u=!0,color:M="#000000",depthWrite:x=!1,renderOrder:y,...L},T)=>{const b=h.useRef(null),O=Ee(j=>j.scene),S=Ee(j=>j.gl),R=h.useRef(null);t=t*(Array.isArray(n)?n[0]:n||1),o=o*(Array.isArray(n)?n[1]:n||1);const[Z,H,_,v,U,E,I]=h.useMemo(()=>{const j=new yt(p,p),ee=new yt(p,p);ee.texture.generateMipmaps=j.texture.generateMipmaps=!1;const K=new Ir(t,o).rotateX(Math.PI/2),be=new er(K),ve=new Ra;ve.depthTest=ve.depthWrite=!1,ve.onBeforeCompile=de=>{de.uniforms={...de.uniforms,ucolor:{value:new Ft(M)}},de.fragmentShader=de.fragmentShader.replace("void main() {",`uniform vec3 ucolor;
           void main() {
          `),de.fragmentShader=de.fragmentShader.replace("vec4( vec3( 1.0 - fragCoordZ ), opacity );","vec4( ucolor * fragCoordZ * 2.0, ( 1.0 - fragCoordZ ) * 1.0 );")};const _e=new wt(vi),J=new wt(gi);return J.depthTest=_e.depthTest=!1,[j,K,ve,be,_e,J,ee]},[p,t,o,n,M]),P=j=>{v.visible=!0,v.material=U,U.uniforms.tDiffuse.value=Z.texture,U.uniforms.h.value=j*1/256,S.setRenderTarget(I),S.render(v,R.current),v.material=E,E.uniforms.tDiffuse.value=I.texture,E.uniforms.v.value=j*1/256,S.setRenderTarget(Z),S.render(v,R.current),v.visible=!1};let V=0,q,$;return it(()=>{R.current&&(e===1/0||V<e)&&(V++,q=O.background,$=O.overrideMaterial,b.current.visible=!1,O.background=null,O.overrideMaterial=_,S.setRenderTarget(Z),S.render(O,R.current),P(l),u&&P(l*.4),S.setRenderTarget(null),b.current.visible=!0,O.overrideMaterial=$,O.background=q)}),h.useImperativeHandle(T,()=>b.current,[]),h.createElement("group",je({"rotation-x":Math.PI/2},L,{ref:b}),h.createElement("mesh",{renderOrder:y,geometry:H,scale:[1,-1,1],rotation:[-Math.PI/2,0,0]},h.createElement("meshBasicMaterial",{transparent:!0,map:Z.texture,opacity:a,depthWrite:x})),h.createElement("orthographicCamera",{ref:R,args:[-t/2,t/2,o/2,-o/2,f,c]}))});function Xi(n){return n.isLight}function Vi(n){return!!n.geometry}const An=h.createContext(null),$i=En({color:new Ft,blend:2,alphaTest:.75,opacity:0,map:null},`varying vec2 vUv;
   void main() {
     gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);
     vUv = uv;
   }`,`varying vec2 vUv;
   uniform sampler2D map;
   uniform vec3 color;
   uniform float opacity;
   uniform float alphaTest;
   uniform float blend;
   void main() {
     vec4 sampledDiffuseColor = texture2D(map, vUv);
     gl_FragColor = vec4(color * sampledDiffuseColor.r * blend, max(0.0, (1.0 - (sampledDiffuseColor.r + sampledDiffuseColor.g + sampledDiffuseColor.b) / alphaTest)) * opacity);
     #include <tonemapping_fragment>
     #include <${bn>=154?"colorspace_fragment":"encodings_fragment"}>
   }`),Ki=h.forwardRef(({children:n,temporal:e,frames:a=40,limit:t=1/0,blend:o=20,scale:l=10,opacity:f=1,alphaTest:c=.75,color:p="black",colorBlend:u=2,resolution:M=1024,toneMapped:x=!0,...y},L)=>{Sr({SoftShadowMaterial:$i});const T=Ee(v=>v.gl),b=Ee(v=>v.scene),O=Ee(v=>v.camera),S=Ee(v=>v.invalidate),R=h.useRef(null),Z=h.useRef(null),[H]=h.useState(()=>new Qi(T,b,M));h.useLayoutEffect(()=>{H.configure(R.current)},[]);const _=h.useMemo(()=>({lights:new Map,temporal:!!e,frames:Math.max(2,a),blend:Math.max(2,a===1/0?o:a),count:0,getMesh:()=>R.current,reset:()=>{H.clear();const v=R.current.material;v.opacity=0,v.alphaTest=0,_.count=0},update:(v=1)=>{const U=R.current.material;_.temporal?(U.opacity=Math.min(f,U.opacity+f/_.blend),U.alphaTest=Math.min(c,U.alphaTest+c/_.blend)):(U.opacity=f,U.alphaTest=c),Z.current.visible=!0,H.prepare();for(let E=0;E<v;E++)_.lights.forEach(I=>I.update()),H.update(O,_.blend);Z.current.visible=!1,H.finish()}}),[H,O,b,e,a,o,f,c]);return h.useLayoutEffect(()=>{_.reset(),!_.temporal&&_.frames!==1/0&&_.update(_.blend)}),h.useImperativeHandle(L,()=>_,[_]),it(()=>{(_.temporal||_.frames===1/0)&&_.count<_.frames&&_.count<t&&(S(),_.update(),_.count++)}),h.createElement("group",y,h.createElement("group",{traverse:()=>null,ref:Z},h.createElement(An.Provider,{value:_},n)),h.createElement("mesh",{receiveShadow:!0,ref:R,scale:l,rotation:[-Math.PI/2,0,0]},h.createElement("planeGeometry",null),h.createElement("softShadowMaterial",{transparent:!0,depthWrite:!1,toneMapped:x,color:p,blend:u,map:H.progressiveLightMap2.texture})))}),qi=h.forwardRef(({castShadow:n=!0,bias:e=.001,mapSize:a=512,size:t=5,near:o=.5,far:l=500,frames:f=1,position:c=[0,0,0],radius:p=1,amount:u=8,intensity:M=bn>=155?Math.PI:1,ambient:x=.5,...y},L)=>{const T=h.useRef(null),b=new re(...c).length(),O=h.useContext(An),S=h.useCallback(()=>{let Z;if(T.current)for(let H=0;H<T.current.children.length;H++)if(Z=T.current.children[H],Math.random()>x)Z.position.set(c[0]+Ct.randFloatSpread(p),c[1]+Ct.randFloatSpread(p),c[2]+Ct.randFloatSpread(p));else{let _=Math.acos(2*Math.random()-1)-Math.PI/2,v=2*Math.PI*Math.random();Z.position.set(Math.cos(_)*Math.cos(v)*b,Math.abs(Math.cos(_)*Math.sin(v)*b),Math.sin(_)*b)}},[p,x,b,...c]),R=h.useMemo(()=>({update:S}),[S]);return h.useImperativeHandle(L,()=>R,[R]),h.useLayoutEffect(()=>{var Z;const H=T.current;return O&&((Z=O.lights)==null||Z.set(H.uuid,R)),()=>{var _;return void(O==null||(_=O.lights)==null?void 0:_.delete(H.uuid))}},[O,R]),h.createElement("group",je({ref:T},y),Array.from({length:u},(Z,H)=>h.createElement("directionalLight",{key:H,castShadow:n,"shadow-bias":e,"shadow-mapSize":[a,a],intensity:M/u},h.createElement("orthographicCamera",{attach:"shadow-camera",args:[-t,t,t,-t,o,l]}))))});class Qi{constructor(e,a,t=1024){this.renderer=e,this.res=t,this.scene=a,this.buffer1Active=!1,this.lights=[],this.meshes=[],this.object=null,this.clearColor=new Ft,this.clearAlpha=0;const o={type:Oe,magFilter:Zr,minFilter:Zr};this.progressiveLightMap1=new yt(this.res,this.res,o),this.progressiveLightMap2=new yt(this.res,this.res,o),this.discardMat=new Si,this.targetMat=new Ta({fog:!1}),this.previousShadowMap={value:this.progressiveLightMap1.texture},this.averagingWindow={value:100},this.targetMat.onBeforeCompile=l=>{l.vertexShader=`varying vec2 vUv;
`+l.vertexShader.slice(0,-1)+"vUv = uv; gl_Position = vec4((uv - 0.5) * 2.0, 1.0, 1.0); }";const f=l.fragmentShader.indexOf("void main() {");l.fragmentShader=`varying vec2 vUv;
`+l.fragmentShader.slice(0,f)+`uniform sampler2D previousShadowMap;
	uniform float averagingWindow;
`+l.fragmentShader.slice(f-1,-1)+`
vec3 texelOld = texture2D(previousShadowMap, vUv).rgb;
        gl_FragColor.rgb = mix(texelOld, gl_FragColor.rgb, 1.0/ averagingWindow);
      }`,l.uniforms.previousShadowMap=this.previousShadowMap,l.uniforms.averagingWindow=this.averagingWindow}}clear(){this.renderer.getClearColor(this.clearColor),this.clearAlpha=this.renderer.getClearAlpha(),this.renderer.setClearColor("black",1),this.renderer.setRenderTarget(this.progressiveLightMap1),this.renderer.clear(),this.renderer.setRenderTarget(this.progressiveLightMap2),this.renderer.clear(),this.renderer.setRenderTarget(null),this.renderer.setClearColor(this.clearColor,this.clearAlpha),this.lights=[],this.meshes=[],this.scene.traverse(e=>{Vi(e)?this.meshes.push({object:e,material:e.material}):Xi(e)&&this.lights.push({object:e,intensity:e.intensity})})}prepare(){this.lights.forEach(e=>e.object.intensity=0),this.meshes.forEach(e=>e.object.material=this.discardMat)}finish(){this.lights.forEach(e=>e.object.intensity=e.intensity),this.meshes.forEach(e=>e.object.material=e.material)}configure(e){this.object=e}update(e,a=100){if(!this.object)return;this.averagingWindow.value=a,this.object.material=this.targetMat;const t=this.buffer1Active?this.progressiveLightMap1:this.progressiveLightMap2,o=this.buffer1Active?this.progressiveLightMap2:this.progressiveLightMap1,l=this.scene.background;this.scene.background=null,this.renderer.setRenderTarget(t),this.previousShadowMap.value=o.texture,this.buffer1Active=!this.buffer1Active,this.renderer.render(this.scene,e),this.renderer.setRenderTarget(null),this.scene.background=l}}const Ji={rembrandt:{main:[1,2,1],fill:[-2,-.5,-2]},portrait:{main:[-1,2,.5],fill:[-1,.5,-1.5]},upfront:{main:[0,2,1],fill:[-1,.5,-1.5]},soft:{main:[-2,4,4],fill:[-1,.5,-1.5]}};function eo({radius:n,adjustCamera:e}){const a=Ci();return h.useEffect(()=>{e&&a.refresh().clip().fit()},[n,e]),null}function to({children:n,center:e,adjustCamera:a=!0,intensity:t=.5,shadows:o="contact",environment:l="city",preset:f="rembrandt",...c}){var p,u,M,x,y,L,T,b;const O=typeof f=="string"?Ji[f]:f,[{radius:S,height:R},Z]=h.useState({radius:0,width:0,height:0,depth:0}),H=(p=o==null?void 0:o.bias)!==null&&p!==void 0?p:-1e-4,_=(u=o==null?void 0:o.normalBias)!==null&&u!==void 0?u:0,v=(M=o==null?void 0:o.size)!==null&&M!==void 0?M:1024,U=(x=o==null?void 0:o.offset)!==null&&x!==void 0?x:0,E=o==="contact"||(o==null?void 0:o.type)==="contact",I=o==="accumulative"||(o==null?void 0:o.type)==="accumulative",P={...typeof o=="object"?o:{}},V=l?typeof l=="string"?{preset:l}:l:null,q=h.useCallback($=>{const{width:j,height:ee,depth:K,boundingSphere:be}=$;Z({radius:be.radius,width:j,height:ee,depth:K}),e!=null&&e.onCentered&&e.onCentered($)},[]);return h.createElement(h.Fragment,null,h.createElement("ambientLight",{intensity:t/3}),h.createElement("spotLight",{penumbra:1,position:[O.main[0]*S,O.main[1]*S,O.main[2]*S],intensity:t*2,castShadow:!!o,"shadow-bias":H,"shadow-normalBias":_,"shadow-mapSize":v}),h.createElement("pointLight",{position:[O.fill[0]*S,O.fill[1]*S,O.fill[2]*S],intensity:t}),h.createElement(Ti,je({fit:!!a,clip:!!a,margin:Number(a),observe:!0},c),h.createElement(eo,{radius:S,adjustCamera:a}),h.createElement(_i,je({},e,{position:[0,U/2,0],onCentered:q}),n)),h.createElement("group",{position:[0,-R/2-U/2,0]},E&&h.createElement(Yi,je({scale:S*4,far:S,blur:2},P)),I&&h.createElement(Ki,je({temporal:!0,frames:100,alphaTest:.9,toneMapped:!0,scale:S*4},P),h.createElement(qi,{amount:(y=P.amount)!==null&&y!==void 0?y:8,radius:(L=P.radius)!==null&&L!==void 0?L:S,ambient:(T=P.ambient)!==null&&T!==void 0?T:.5,intensity:(b=P.intensity)!==null&&b!==void 0?b:1,position:[O.main[0]*S,O.main[1]*S,O.main[2]*S],size:S*4,bias:-H,mapSize:v}))),l&&h.createElement(Cn,V))}const Ur=h.createContext({isReady:!1,setReady:()=>{}});function ro(n,{whileHover:e,onHoverStart:a,onHoverEnd:t,onPointerOver:o,onPointerOut:l},f){return n||!f||!(e||a||t)?{}:{onPointerOver:p=>{var u;(u=f.animationState)===null||u===void 0||u.setActive("whileHover",!0),o&&o(p)},onPointerOut:p=>{var u;(u=f.animationState)===null||u===void 0||u.setActive("whileHover",!1),l&&l(p)}}}function no(n,{whileTap:e,onTapStart:a,onTap:t,onTapCancel:o,onPointerDown:l},f){const c=t||a||o||e,p=h.useRef(!1),u=h.useRef(null);if(n||!f||!c)return{};function M(){var T;(T=u.current)===null||T===void 0||T.call(u),u.current=null}function x(){var T;return M(),p.current=!1,(T=f.animationState)===null||T===void 0||T.setActive("whileTap",!1),!zn()}function y(T,b){x()&&(t==null||t(T,b))}function L(T,b){x()&&(o==null||o(T,b))}return{onPointerDown:Nn((T,b)=>{var O;if(M(),p.current)return;p.current=!0;const S={passive:!(a||t||o||l)};u.current=kn(zr(window,"pointerup",y,S),zr(window,"pointercancel",L,S)),(O=f.animationState)===null||O===void 0||O.setActive("whileTap",!0),l==null||l(T),a==null||a(T,b)})}}const ao=(n,e,a,t,o,l)=>{const f=io(e);return h.createElement(n,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({ref:a},Bn(e,!1,!1)),f),{onUpdate:e.onInstanceUpdate}),ro(o,e,l)),no(o,e,l)))};function io(n){return h.useMemo(()=>{const e={};for(const a in n){const t=n[a];pt(t)?e[a]=t.get():Array.isArray(t)&&t.includes(pt)&&(e[a]=t.map(Hn))}return e},[])}function oo(n,e){var a={};for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&e.indexOf(t)<0&&(a[t]=n[t]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,t=Object.getOwnPropertySymbols(n);o<t.length;o++)e.indexOf(t[o])<0&&Object.prototype.propertyIsEnumerable.call(n,t[o])&&(a[t[o]]=n[t[o]]);return a}const On=(n,e)=>a=>(t,o)=>{t[n]===void 0&&(t[n]=new re(e)),t[n].setComponent(a,o)},so=(n,e)=>a=>(t,o)=>{t[n]===void 0&&(t[n]=new Ca(e));const l=t[n];l[a]=o},en=n=>(e,a)=>{e[n]===void 0&&(e[n]=new Ft(a)),e[n].set(a)},pr=On("scale",1),mr=On("position",0),vr=so("rotation",0),tn={x:mr(0),y:mr(1),z:mr(2),scale:(n,e)=>{n.scale===void 0&&(n.scale=new re(1)),n.scale.set(e,e,e)},scaleX:pr(0),scaleY:pr(1),scaleZ:pr(2),rotateX:vr("x"),rotateY:vr("y"),rotateZ:vr("z"),color:en("color"),specular:en("specular")};function lo(n,e,a){tn[e]?tn[e](n,a[e]):(e==="opacity"&&!n.transparent&&(n.transparent=!0),n[e]=a[e])}const Lr=(n,e)=>a=>t=>{const o=t[n];return o?o[a]:e},gr=Lr("position",0),$t=Lr("scale",1),wr=Lr("rotation",0),rn={x:gr("x"),y:gr("y"),z:gr("z"),scale:$t("x"),scaleX:$t("x"),scaleY:$t("y"),scaleZ:$t("z"),rotateX:wr("x"),rotateY:wr("y"),rotateZ:wr("z")};function co(n){if(n!==void 0)return n instanceof Ft?n.getStyle():n}function uo(n,e){return rn[e]?rn[e](n):co(n[e])||0}const ho=["x","y","z"],nn={"position-x":"x","position-y":"y","position-z":"z","rotation-x":"rotateX","rotation-y":"rotateY","rotation-z":"rotateZ","scale-x":"scaleX","scale-y":"scaleY","scale-z":"scaleZ"},Pn=(n,e)=>{const a={};for(const t in n){const o=n[t];if(pt(o)||pt(e[t]))a[nn[t]||t]=o;else if(Array.isArray(o))for(let l=0;l<o.length;l++){const f=o[l];if(pt(f)||Array.isArray(e[t])&&pt(e[t][l])){const c=nn[t+"-"+ho[l]];a[c]=f}}}return a},fo=()=>({});class po extends jn{constructor(){super(...arguments),this.type="three"}readValueFromInstance(e,a){return uo(e,a)}getBaseTargetFromProps(){}sortInstanceNodePosition(e,a){return e.id-a.id}makeTargetAnimatableFromInstance(e){var{transition:a,transitionEnd:t}=e,o=oo(e,["transition","transitionEnd"]);return Zn(this,o,{}),Object.assign(Object.assign({},o),{transition:a,transitionEnd:t})}removeValueFromRenderState(){}measureInstanceViewportBox(){return Gn()}scrapeMotionValuesFromProps(e,a){return Pn(e,a)}build(e,a){for(const t in a)e[t]=a[t]}renderInstance(e,a){for(const t in a)lo(e,t,a)}}const mo=(n,e)=>new po(e,{}),vo=Yn({scrapeMotionValuesFromProps:Pn,createRenderState:fo}),go=Object.assign({},Xn);function an(n){return Wn({Component:n,preloadedFeatures:go,useRender:ao,useVisualState:vo,createVisualElement:mo})}const yr=new Map,wo=new Proxy(an,{get:(n,e)=>(!yr.has(e)&&yr.set(e,an(e)),yr.get(e))});function yo(){const[n,e]=h.useState(0);return h.useEffect(()=>{const a=()=>{e(window.scrollY)};return window.addEventListener("scroll",a,{passive:!0}),()=>window.removeEventListener("scroll",a)},[]),n}function Er({path:n,position:e,rotation:a,initialRotation:t,scale:o=[2,2,2]}){const{scene:l}=Aa(n),f=h.useRef(null),c=yo(),[p]=h.useState(()=>[...a]),u=h.useRef(0),[M,x]=h.useState(!1),{isReady:y}=h.useContext(Ur);h.useEffect(()=>{l&&!M&&x(!0)},[l]);const L=M&&y,T=h.useMemo(()=>L?e:[e[0],e[1]-5,e[2]],[L,e]);return it((b,O)=>{if(f.current&&L){const S=c*.002+a[1],R=u.current+(S-u.current)*.1;u.current=R,f.current.rotation.y=R}}),ye.jsx(Ai,{speed:2,rotationIntensity:.5,floatIntensity:.5,children:ye.jsx(wo.group,{ref:f,position:T,rotation:[a[0],p[1],a[2]],initial:{scale:.8,opacity:0,y:e[1]-10},animate:{scale:L?1:.8,opacity:L?1:0,y:L?e[1]:e[1]-5},transition:{type:"spring",stiffness:100,damping:20,mass:1},children:ye.jsx("primitive",{object:l,scale:o,rotation:[-Math.PI/4,Math.PI,0]})})})}function Eo(){const{setReady:n}=h.useContext(Ur),{scene:e}=Ee();return h.useEffect(()=>{let a;const t=()=>{if(e.environment||e.background){n(!0);return}a=requestAnimationFrame(t)};return t(),()=>cancelAnimationFrame(a)},[e,n]),ye.jsx(Cn,{files:"potsdamer_platz_1k.hdr",path:"/models/"})}function So(){const[l,f]=h.useState(!1),c={isReady:l,setReady:f};return ye.jsxs(Ya,{shadows:!0,dpr:[1,2],camera:{position:[0,4,25],fov:45},resize:{scroll:!1},children:[ye.jsx(to,{intensity:.6,children:ye.jsx(Ur.Provider,{value:c,children:ye.jsxs(h.Suspense,{fallback:null,children:[ye.jsx(Eo,{}),ye.jsx(Er,{path:"/models/torus.glb",position:[-40,8,-4],rotation:[0,Math.PI/4,0],initialRotation:[0,0,0],scale:[150,150,150]}),ye.jsx(Er,{path:"/models/tesseract.glb",position:[8,8,0],rotation:[0,0,0],initialRotation:[0,0,0],scale:[2,2,2]}),ye.jsx(Er,{path:"/models/weirdshape.glb",position:[56,8+0*2,4],rotation:[0,-Math.PI/4,0],initialRotation:[0,0,0],scale:[150,150,150]})]})})}),ye.jsx(bi,{enableZoom:!1,enablePan:!1,minPolarAngle:Math.PI/3,maxPolarAngle:Math.PI/2})]})}export{So as default};
